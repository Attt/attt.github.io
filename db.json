{"meta":{"version":1,"warehouse":"4.0.1"},"models":{"Asset":[{"_id":"themes/one-paper/source/css/a11y-dark.min.css","path":"css/a11y-dark.min.css","modified":0,"renderable":1},{"_id":"themes/one-paper/source/css/fonts.css","path":"css/fonts.css","modified":0,"renderable":1},{"_id":"themes/one-paper/source/css/markdown.css","path":"css/markdown.css","modified":0,"renderable":1},{"_id":"themes/one-paper/source/css/reset.css","path":"css/reset.css","modified":0,"renderable":1},{"_id":"themes/one-paper/source/css/style.css","path":"css/style.css","modified":1,"renderable":1},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-600.woff","path":"fonts/montserrat-v23-latin-600.woff","modified":0,"renderable":1},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-600.woff2","path":"fonts/montserrat-v23-latin-600.woff2","modified":0,"renderable":1},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-600italic.woff","path":"fonts/montserrat-v23-latin-600italic.woff","modified":0,"renderable":1},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-600italic.woff2","path":"fonts/montserrat-v23-latin-600italic.woff2","modified":0,"renderable":1},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-italic.woff","path":"fonts/montserrat-v23-latin-italic.woff","modified":0,"renderable":1},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-regular.woff","path":"fonts/montserrat-v23-latin-regular.woff","modified":0,"renderable":1},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-regular.woff2","path":"fonts/montserrat-v23-latin-regular.woff2","modified":0,"renderable":1},{"_id":"themes/one-paper/source/img/favicon.ico","path":"img/favicon.ico","modified":0,"renderable":1},{"_id":"themes/one-paper/source/img/favicon.png","path":"img/favicon.png","modified":0,"renderable":1},{"_id":"themes/one-paper/source/img/one-paper.png","path":"img/one-paper.png","modified":0,"renderable":1},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-italic.woff2","path":"fonts/montserrat-v23-latin-italic.woff2","modified":0,"renderable":1},{"_id":"themes/one-paper/source/js/highlight.min.js","path":"js/highlight.min.js","modified":0,"renderable":1},{"_id":"themes/one-paper/source/js/highlightjs-line-numbers.js","path":"js/highlightjs-line-numbers.js","modified":0,"renderable":1},{"_id":"source/images/0.jpg","path":"images/0.jpg","modified":0,"renderable":0},{"_id":"source/images/me.png","path":"images/me.png","modified":0,"renderable":0}],"Cache":[{"_id":"source/_posts/arch-linux-setup-guide.md","hash":"7d89131ee61f0d6a59cb9a6af7fcb78cf11b6d5b","modified":1655133445307},{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class.md","hash":"c3af8a13c58aa6bbbd13ff27914268ef33a4099c","modified":1655133776308},{"_id":"source/_posts/fgo-frida-il2cpp-bridge.md","hash":"8eb7a5af4a05b7d144110f5b14b134b1a0d622c9","modified":1655133826980},{"_id":"source/_posts/shell-some-memos-for-shell-script.md","hash":"14357b89db253a93db25a9358ca8b2ae1eb0bfe0","modified":1655133798306},{"_id":"source/_posts/memo-2022-06-13.md","hash":"5b3c9ebe129bb0e0c1302acdcfcd48aada6a8d57","modified":1655134294726},{"_id":"source/about/index.md","hash":"7c030615874dfef6a20b885b905092851517f077","modified":1650264016854},{"_id":"source/categories/index.md","hash":"6ccd1de20346e08e0a76785ae7628524f934a9be","modified":1655131084755},{"_id":"themes/one-paper/LICENSE","hash":"63e36dbfe7c70d3964eb275b4f25626d3cd38f59","modified":1650264016858},{"_id":"themes/one-paper/README.md","hash":"30611397615d58b41c2009ef46d1a17623f2bec3","modified":1650264016858},{"_id":"themes/one-paper/_config.yml","hash":"b1ff3db7461487f34eb237ab08581a93ab5cbe2a","modified":1655129796463},{"_id":"themes/one-paper/layout/archive.ejs","hash":"a6ba7e064802869da54f427a69067cebac47101b","modified":1650264016861},{"_id":"themes/one-paper/layout/categories.ejs","hash":"a37771110b8987ed13cedd95dee89a549531b7a2","modified":1655134046805},{"_id":"themes/one-paper/layout/layout.ejs","hash":"9e2a698228b580fa29b30ce5015cfba3a6624fba","modified":1655132971667},{"_id":"themes/one-paper/layout/post.ejs","hash":"dd483923829f92deaf8c6c470b838f653c952bce","modified":1650264016863},{"_id":"themes/one-paper/layout/_partial/footer.ejs","hash":"98875b6d130a767c08e5421ab9e9f9b19b522f47","modified":1650348231586},{"_id":"themes/one-paper/layout/index.ejs","hash":"20357831a55cd087e4522425572a3c321fc42cd7","modified":1650264016862},{"_id":"themes/one-paper/layout/_partial/head.ejs","hash":"95eb54863a3048896b6b94ac840d4f9bb0ea8b7d","modified":1650264016860},{"_id":"themes/one-paper/layout/_partial/header.ejs","hash":"1ea2c2abe9fee0d73491085104979f927edc3515","modified":1650264016860},{"_id":"themes/one-paper/layout/_partial/paginator.ejs","hash":"609938b2b4c697cddfbf54b9bc07582521d854be","modified":1650264016861},{"_id":"themes/one-paper/layout/_partial/post-header.ejs","hash":"955216e0a4e7b0f44849efbf02fbef7f1faaf2ee","modified":1650264016861},{"_id":"themes/one-paper/source/css/a11y-dark.min.css","hash":"cd394c6bcc1d9fae73ec02069a224142382ef872","modified":1650891368324},{"_id":"themes/one-paper/source/css/fonts.css","hash":"e7ed9f16d18b27bcd05889f750c51a8f6b8da64b","modified":1650894183004},{"_id":"themes/one-paper/source/css/markdown.css","hash":"25ce6518967923af027b4828fce935d26169b189","modified":1650894970265},{"_id":"themes/one-paper/source/css/reset.css","hash":"d93952b2bc63a8f7624f2b2a9c4eb2c985ef0baa","modified":1650264016865},{"_id":"themes/one-paper/source/css/style.css","hash":"887ac9a506c78ab21b74b25559f1703e9e805503","modified":1655134250200},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-600.woff","hash":"925d9f095488dc77dd84e8414422f0113f4628a9","modified":1650264016867},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-600italic.woff","hash":"c0e80c18fac1cd10469c4f922ad92e81fc8b3b94","modified":1650264016868},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-600.woff2","hash":"2fe30978041c41a2994ac0fd491e83d32a3203b7","modified":1650264016867},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-600italic.woff2","hash":"1f24e9edcccd42d4694a4020d6a8f9b9cb28f471","modified":1650264016868},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-italic.woff","hash":"fca5ee87a17c57eb53265da1c2c75db7305ad69c","modified":1650264016869},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-regular.woff","hash":"285adda1da1fc15583ad53160d66032aeccb45ea","modified":1650264016870},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-regular.woff2","hash":"f7eefafb7bfdc6b5572714fa267268b845a67cf4","modified":1650264016870},{"_id":"themes/one-paper/source/img/favicon.ico","hash":"ebe06d671cb14bdb8eb4cb785d5a21e20b1b3902","modified":1650264016871},{"_id":"themes/one-paper/source/img/favicon.png","hash":"ebe06d671cb14bdb8eb4cb785d5a21e20b1b3902","modified":1650264016871},{"_id":"themes/one-paper/source/fonts/montserrat-v23-latin-italic.woff2","hash":"ce1eae3f714702a82c1e9c05b5ba302a9e91ac20","modified":1650264016869},{"_id":"themes/one-paper/source/js/highlightjs-line-numbers.js","hash":"277b6a575a9e057d8ee57deffe9c6e0aa392d898","modified":1650264016876},{"_id":"source/images/me.png","hash":"0a5449222d1957e9b69dabca1db65b51c53798ea","modified":1650264016856},{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class/0.png","hash":"622a8e751c216e4020cb319f9e0ca67f462d5208","modified":1650264016820},{"_id":"themes/one-paper/source/js/highlight.min.js","hash":"cc9d8260a9c36493a9bf52a6fd8d6333ae991af1","modified":1650264016875},{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class/5.png","hash":"32d8635ee433032162bc323cc0c7a9e1388649dc","modified":1650264016852},{"_id":"source/images/0.jpg","hash":"974145668d7657911d0fee01f816868293fe2e4f","modified":1650264016855},{"_id":"themes/one-paper/source/img/one-paper.png","hash":"eadd349e5316a154099cb06e41abe5a105940e37","modified":1650264016874},{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class/3.png","hash":"68a5a7ff36fe2e3e8288a954ff9df6ba038234a1","modified":1650264016842},{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class/2.png","hash":"5e49a6750f7235e6581109f549aba4720b0b4e1e","modified":1650264016836},{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class/4.png","hash":"3734fddc126b1b739525b7298ca463a8e167c2c3","modified":1650264016851},{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class/1.png","hash":"070e8c7d6bb1139c83822c0148cac0135ec4c448","modified":1650264016829},{"_id":"public/categories/index.html","hash":"622c0dfd66648f3d467bc5b054c8fdbfd473b262","modified":1655134324884},{"_id":"public/about/index.html","hash":"08773293022a298013f32ef92b60749b3e2c6c72","modified":1655134324884},{"_id":"public/2022/03/19/shell-some-memos-for-shell-script/index.html","hash":"91aa0a66e2d3506bdb073683e047e8b677b9b68c","modified":1655134324884},{"_id":"public/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/index.html","hash":"ba47bb962c8d3c481a211aecffa2c0ea7e0cf6c1","modified":1655134324884},{"_id":"public/2022/03/17/fgo-frida-il2cpp-bridge/index.html","hash":"9f9147f0d6be45ba9cee1b7314e81a12b6c43e48","modified":1655134324884},{"_id":"public/categories/memo/index.html","hash":"53dfe51f3ae19db862dd247620fb7c1ffab8caf0","modified":1655131909613},{"_id":"public/archives/index.html","hash":"7517368940b670a00480e095829f8f7479f81fee","modified":1655134324884},{"_id":"public/archives/2022/index.html","hash":"7517368940b670a00480e095829f8f7479f81fee","modified":1655134324884},{"_id":"public/archives/2022/03/index.html","hash":"74f1b0e73e09b3e21f49629448db7d43f7e2b202","modified":1655134324884},{"_id":"public/archives/2022/04/index.html","hash":"9e284fed08c60aa90e56c261dac2f5060ba1a843","modified":1655134324884},{"_id":"public/archives/2022/06/index.html","hash":"9f25dab97866c30a3f66fd63c689e1f067b71013","modified":1655134324884},{"_id":"public/index.html","hash":"b677e1ac2e9c1bd73bdaf9924c51344628854b80","modified":1655134324884},{"_id":"public/2022/06/13/memo-2022-06-13/index.html","hash":"ea993341ecdb8622ad1a2f15d57281dfb3291868","modified":1655134324884},{"_id":"public/2022/04/19/arch-linux-setup-guide/index.html","hash":"105fea0d60a981ce8c01456d3fe63602e99bb7ff","modified":1655134324884},{"_id":"public/tags/spring/index.html","hash":"53dfe51f3ae19db862dd247620fb7c1ffab8caf0","modified":1655131909613},{"_id":"public/fonts/montserrat-v23-latin-600italic.woff2","hash":"1f24e9edcccd42d4694a4020d6a8f9b9cb28f471","modified":1655134324884},{"_id":"public/fonts/montserrat-v23-latin-600.woff","hash":"925d9f095488dc77dd84e8414422f0113f4628a9","modified":1655134324884},{"_id":"public/fonts/montserrat-v23-latin-600italic.woff","hash":"c0e80c18fac1cd10469c4f922ad92e81fc8b3b94","modified":1655134324884},{"_id":"public/fonts/montserrat-v23-latin-600.woff2","hash":"2fe30978041c41a2994ac0fd491e83d32a3203b7","modified":1655134324884},{"_id":"public/fonts/montserrat-v23-latin-regular.woff","hash":"285adda1da1fc15583ad53160d66032aeccb45ea","modified":1655134324884},{"_id":"public/fonts/montserrat-v23-latin-italic.woff","hash":"fca5ee87a17c57eb53265da1c2c75db7305ad69c","modified":1655134324884},{"_id":"public/fonts/montserrat-v23-latin-regular.woff2","hash":"f7eefafb7bfdc6b5572714fa267268b845a67cf4","modified":1655134324884},{"_id":"public/img/favicon.ico","hash":"ebe06d671cb14bdb8eb4cb785d5a21e20b1b3902","modified":1655134324884},{"_id":"public/img/favicon.png","hash":"ebe06d671cb14bdb8eb4cb785d5a21e20b1b3902","modified":1655134324884},{"_id":"public/fonts/montserrat-v23-latin-italic.woff2","hash":"ce1eae3f714702a82c1e9c05b5ba302a9e91ac20","modified":1655134324884},{"_id":"public/images/me.png","hash":"0a5449222d1957e9b69dabca1db65b51c53798ea","modified":1655134324884},{"_id":"public/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/0.png","hash":"622a8e751c216e4020cb319f9e0ca67f462d5208","modified":1655134324884},{"_id":"public/css/a11y-dark.min.css","hash":"e0a3294faa7dfa1eae300caea5a01f438b643b93","modified":1655134324884},{"_id":"public/css/fonts.css","hash":"2682674267a6e768c8dcc8f97cafe0eee6ae3baa","modified":1655134324884},{"_id":"public/css/reset.css","hash":"f6184d3f74dc704f077ca4e0b91003652a9db978","modified":1655134324884},{"_id":"public/css/markdown.css","hash":"1a25aa5a756e598b04062bf39c35b7d8ae2d057c","modified":1655134324884},{"_id":"public/css/style.css","hash":"7da7c139e3f57d1f03f24747ad2948c5d6b48b01","modified":1655134324884},{"_id":"public/js/highlightjs-line-numbers.js","hash":"690e96133591495fa847d828573bd0576b2d168a","modified":1655134324884},{"_id":"public/js/highlight.min.js","hash":"d264ad16bdf39cfec2b06c20223b87fcb37ad27b","modified":1655134324884},{"_id":"public/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/5.png","hash":"32d8635ee433032162bc323cc0c7a9e1388649dc","modified":1655134324884},{"_id":"public/images/0.jpg","hash":"974145668d7657911d0fee01f816868293fe2e4f","modified":1655134324884},{"_id":"public/img/one-paper.png","hash":"eadd349e5316a154099cb06e41abe5a105940e37","modified":1655134324884},{"_id":"public/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/3.png","hash":"68a5a7ff36fe2e3e8288a954ff9df6ba038234a1","modified":1655134324884},{"_id":"public/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/2.png","hash":"5e49a6750f7235e6581109f549aba4720b0b4e1e","modified":1655134324884},{"_id":"public/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/4.png","hash":"3734fddc126b1b739525b7298ca463a8e167c2c3","modified":1655134324884},{"_id":"public/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/1.png","hash":"070e8c7d6bb1139c83822c0148cac0135ec4c448","modified":1655134324884},{"_id":"source/tags/index.md","hash":"1c60e5c61c112001eccf9ff4e35958a47d4de0be","modified":1655132808750},{"_id":"themes/one-paper/layout/tags.ejs","hash":"dedbf2ecde55c79ed016a806a1dea1d264f5472e","modified":1655133972383},{"_id":"public/tags/index.html","hash":"c33a27e3f4865a30bbdc90391f61f18458b4e2e0","modified":1655134324884},{"_id":"public/categories/spring/index.html","hash":"9f25dab97866c30a3f66fd63c689e1f067b71013","modified":1655134324884},{"_id":"public/categories/linux/index.html","hash":"801c1acc387e5650d1ece1867346392cc3a49e31","modified":1655134324884},{"_id":"public/categories/java/index.html","hash":"8e9b070c358b30eff1cd2eb5c9ce3b93b49be5a9","modified":1655134324884},{"_id":"public/categories/hack/index.html","hash":"257774e0976e493c54c057a9b16ab46a8fa0e71c","modified":1655134324884},{"_id":"public/tags/memo/index.html","hash":"261bc9e26efb9e3645a2346f09afd79bcadc3eec","modified":1655134324884},{"_id":"public/tags/rabbitmq/index.html","hash":"9f25dab97866c30a3f66fd63c689e1f067b71013","modified":1655134324884},{"_id":"public/tags/spring-config/index.html","hash":"9f25dab97866c30a3f66fd63c689e1f067b71013","modified":1655134324884},{"_id":"public/tags/rabbitmq-config/index.html","hash":"9f25dab97866c30a3f66fd63c689e1f067b71013","modified":1655134324884},{"_id":"public/tags/spring-source-code/index.html","hash":"9f25dab97866c30a3f66fd63c689e1f067b71013","modified":1655134324884},{"_id":"public/tags/util/index.html","hash":"9f25dab97866c30a3f66fd63c689e1f067b71013","modified":1655134324884},{"_id":"public/tags/setup/index.html","hash":"9e284fed08c60aa90e56c261dac2f5060ba1a843","modified":1655134324884},{"_id":"public/tags/arch-linux/index.html","hash":"9e284fed08c60aa90e56c261dac2f5060ba1a843","modified":1655134324884},{"_id":"public/tags/linux/index.html","hash":"801c1acc387e5650d1ece1867346392cc3a49e31","modified":1655134324884},{"_id":"public/tags/wallhack/index.html","hash":"257774e0976e493c54c057a9b16ab46a8fa0e71c","modified":1655134324884},{"_id":"public/tags/fgo/index.html","hash":"257774e0976e493c54c057a9b16ab46a8fa0e71c","modified":1655134324884},{"_id":"public/tags/jvm/index.html","hash":"8e9b070c358b30eff1cd2eb5c9ce3b93b49be5a9","modified":1655134324884},{"_id":"public/tags/java/index.html","hash":"8e9b070c358b30eff1cd2eb5c9ce3b93b49be5a9","modified":1655134324884},{"_id":"public/tags/jvm-memory/index.html","hash":"8e9b070c358b30eff1cd2eb5c9ce3b93b49be5a9","modified":1655134324884},{"_id":"public/tags/shell/index.html","hash":"05970941e196eb8723461c5243f125b8c7beaea6","modified":1655134324884},{"_id":"public/tags/shell-script/index.html","hash":"05970941e196eb8723461c5243f125b8c7beaea6","modified":1655134324884},{"_id":"public/tags/injection/index.html","hash":"257774e0976e493c54c057a9b16ab46a8fa0e71c","modified":1655134324884},{"_id":"public/tags/reverse-engineering/index.html","hash":"257774e0976e493c54c057a9b16ab46a8fa0e71c","modified":1655134324884}],"Category":[{"name":"Memo","_id":"cl4cuks420007doou46jx1vew"},{"name":"Spring","parent":"cl4cuks420007doou46jx1vew","_id":"cl4cuvv7p00004cou9891dk6e"},{"name":"Spring","_id":"cl4cuyblr00024coudxtqfdb4"},{"name":"Linux","_id":"cl4cvo9y7000hagoufsyweg58"},{"name":"wallhack","_id":"cl4cvoytz000ragouhdl99awk"},{"name":"game injection","parent":"cl4cvoytz000ragouhdl99awk","_id":"cl4cvpp2k000tagou94d31enf"},{"name":"reverse engineering","parent":"cl4cvoytz000ragouhdl99awk","_id":"cl4cvsqip0011agou5dp21dvq"},{"name":"JVM","_id":"cl4cvta7v0013agoudngl3bus"},{"name":"Java","parent":"cl4cvta7v0013agoudngl3bus","_id":"cl4cvta7w0016agougq7rfzes"},{"name":"shell","_id":"cl4cvuxe8001dagouh5455lux"},{"name":"Linux","parent":"cl4cvuxe8001dagouh5455lux","_id":"cl4cvuxe9001gagoubv2108y1"},{"name":"Java","parent":"cl4cuyblr00024coudxtqfdb4","_id":"cl4cvvhys001pagou0ylyc75h"},{"name":"reverse engineering","_id":"cl4cvwq8y001ragou8cwj7ud3"},{"name":"Java","_id":"cl4cvwzgy001xagou78ybcy1h"},{"name":"hack","_id":"cl4cvy2k90020agou04xg4gui"}],"Data":[],"Page":[{"title":"about","date":"2022-03-17T07:10:42.000Z","_content":"\n# About\n\n<img src=\"/images/me.png\" alt=\"me\" style=\"width:200px\"/>\n\n`「撃っていいのは、撃たれる覚悟のある奴だけだ。」`\n","source":"about/index.md","raw":"---\ntitle: about\ndate: 2022-03-17 15:10:42\n---\n\n# About\n\n<img src=\"/images/me.png\" alt=\"me\" style=\"width:200px\"/>\n\n`「撃っていいのは、撃たれる覚悟のある奴だけだ。」`\n","updated":"2022-04-18T06:40:16.854Z","path":"about/index.html","comments":1,"layout":"page","_id":"cl4cuks3l0000doougaypc774","content":"<h1 id=\"About\"><a href=\"#About\" class=\"headerlink\" title=\"About\"></a>About</h1><img src=\"/images/me.png\" alt=\"me\" style=\"width:200px\"/>\n\n<p><code>「撃っていいのは、撃たれる覚悟のある奴だけだ。」</code></p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"About\"><a href=\"#About\" class=\"headerlink\" title=\"About\"></a>About</h1><img src=\"/images/me.png\" alt=\"me\" style=\"width:200px\"/>\n\n<p><code>「撃っていいのは、撃たれる覚悟のある奴だけだ。」</code></p>\n"},{"title":"categories","date":"2022-06-13T14:09:39.000Z","type":"categories","layout":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: categories\ndate: 2022-06-13 22:09:39\ntype: \"categories\"\nlayout: \"categories\"\n---\n","updated":"2022-06-13T14:38:04.755Z","path":"categories/index.html","comments":1,"_id":"cl4cuks3t0002dooua2g0f6ns","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"tags","date":"2022-06-13T15:06:11.000Z","type":"tags","layout":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: tags\ndate: 2022-06-13 23:06:11\ntype: \"tags\"\nlayout: \"tags\"\n---\n","updated":"2022-06-13T15:06:48.750Z","path":"tags/index.html","comments":1,"_id":"cl4cveh6p0000agou59q8h2ur","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"Arch Linux Setup","date":"2022-04-19T03:23:08.000Z","_content":"> https://wiki.archlinux.org/\n\n## 基本系统安装\n### 前置准备\n- 检查网络\n  ```bash \n  ip link\n  ```\n- 更新系统时间\n  ```bash\n  timedatectl set-ntp true\n  ```\n### 准备磁盘\n- 分区\n  - 查看当前磁盘信息\n  ```bash\n  fdisk -l\n  ```\n  - 进入分区\n  ```bash\n  fdisk /dev/the_disk_to_be_partitioned（要被分区的磁盘）\n  ```\n  uefi参考：\n  | 挂载点 | 分区 | 分区类型 | 大小 |\n  | -- | -- | -- | -- |\n  | /mnt/boot/EFI| /dev/efi_system_partition | EFI系统分区 | 300M |\n  | \\[swap\\] **移动设备建议不要**| /dev/swap_partition/ |Linux swap (交换空间) | > 512M (2G if physical ram > 4G) |\n  | /mnt| /dev/root_partition | Linux x86-64 根目录 (/) | 剩余空间 |\n\n  - *移动设备的情况下:*\n    | 挂载点 | 分区 | 分区类型 | 大小 |\n    | -- | -- | -- | -- |\n    | *none* | *none* | BIOS启动分区 | 1M |\n    | /mnt/boot/EFI| /dev/efi_system_partition | EFI系统分区 | 300M |\n    | /mnt| /dev/root_partition | Linux x86-64 根目录 (/) | 剩余空间 |\n\n  - 格式化分区\n  ```bash\n   mkfs.ext4 /dev/root_partition（根分区）\n   # 移动设备关闭日志 mkfs.ext4 -O \"^has_journal\" /dev/root_partition（根分区）\n   mkswap /dev/swap_partition（交换空间分区）\n   mkfs.fat -F 32 /dev/efi_system_partition\n  ```\n  - 挂载分区&启用交换空间\n  ```bash\n  mount /dev/root_partition（根分区） /mnt\n  mount /dev/efi_system_partition /mnt/boot/efi\n  swapon /dev/swap_partition（交换空间分区）\n  ```\n### 安装系统\n  - 设置cn源\n    \n    第一种方法\n      ```bash\n      #!/bin/bash\n      curl 'https://archlinux.org/mirrorlist/?country=CN&prototcol=http&protocol=https&ip_version=4' > /etc/pacman.d/mirrorlist && \\\n      echo /etc/pacman.d/mirrorlist && \\\n      sudo vim /etc/pacman.d/mirrorlist && \\\n      echo 'pacman mirror list updated'\n      ```\n      然后将`/etc/pacman.d/mirrorlist`中注释去掉\n        \n    第二种方法\n\n    在`/etc/pacman.d/mirrorlist`中搜索CN，放到最前面，推荐aliyun的源\n\n  - 安装系统&软件包\n  ```bash\n  pacstrap /mnt base base-devel linux linux-firmware vim vi sudo git\n  # 移动设备 可以使用基于BFQ的io调度内核linux-zen，把linux换成linux-zen\n  ```\n  *参考：[BFQ](https://www.kernel.org/doc/html/latest/block/bfq-iosched.html)*\n\n## 系统配置\n### 系统引导\n  - 配置fstab\n  ```bash\n  genfstab -U /mnt >> /mnt/etc/fstab\n  ```\n  - 安装grub\n  ```bash\n  pacman -S efibootmgr grub\n\n  # uefi\n  grub-install --target=x86_64-efi --efi-directory={挂载点,如/mnt/boot/EFI} --bootloader-id=GRUB\n\n  # bios(非GPT分区无需其他空间，但GPT分区需要有一块1M的BIOS boot分区)\n  grub-install --target=i386-pc /dev/sdX\n  ```\n  *移动设备的情况下*\n\n  假设分区顺序是：\n    - BIOS\n    - EFI\n    - root\n  要先在这块设备上写入引导信息，运行`gdisk /dev/sdX`\n\n  ```bash\n  # gdisk /dev/sdX\n\n  Command (? for help): r\n  Recovery/transformation command (? for help): h\n\n  WARNING! Hybrid MBRs are flaky and dangerous! If you decide not to use one,\n  just hit the Enter key at the below prompt and your MBR partition table will\n  be untouched.\n\n  Type from one to three GPT partition numbers, separated by spaces, to be added to the hybrid MBR, in sequence: 1 2 3\n  Place EFI GPT (0xEE) partition first in MBR (good for GRUB)? (Y/N): N\n\n  Creating entry for GPT partition #1 (MBR partition #1)\n  Enter an MBR hex code (default EF): \n  Set the bootable flag? (Y/N): N\n\n  Creating entry for GPT partition #2 (MBR partition #2)\n  Enter an MBR hex code (default EF): \n  Set the bootable flag? (Y/N): N\n\n  Creating entry for GPT partition #3 (MBR partition #3)\n  Enter an MBR hex code (default 83): \n  Set the bootable flag? (Y/N): Y\n\n  Recovery/transformation command (? for help): x\n  Expert command (? for help): h\n  Expert command (? for help): w\n\n  Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING\n  PARTITIONS!!\n\n  Do you want to proceed? (Y/N): Y\n  ```\n  \n  > **如果不需要兼容，不用做这一步，混合分区会在设备上存在两个分区表，系统识别这个设备分区的时候具体的行为完全依赖于系统的实现，非常不稳定**\n\n  > **注意：写完hybrid之后，默认的windows中就只认MBR分区，假设分区按上面的例子，且还有一个4号分区，那么由于MBR的限制**\n  > **在windows中第四个分区是无法正确识别文件系统的，如果要使用第四个分区且要通过MBR引导，那么这里就要在MBR写入134分区**\n  > **ESP分区可以不用写到MBR里**\n\n\n  ```bash\n  pacman -S efibootmgr grub amd-ucode intel-ucode\n\n  # uefi + MBR(BIOS)混合启动\n  grub-install --target=x86_64-efi --efi-directory={挂载点,如/mnt/boot/EFI} --removable\n   --bootloader-id=GRUB --boot-directory={root挂载点,如/mnt}/boot\n\n  grub-install --target=i386-pc --recheck --boot-directory=/DATA_MOUNTPOINT/boot /dev/sdX #注意这里是整个设备\n\n  # 作为保险\n  grub-install --target=i386-pc --recheck --boot-directory=/DATA_MOUNTPOINT/boot /dev/{root的那个分区}\n  ```\n  - 切换到已经安装的系统\n  ```bash\n  arch-chroot /mnt\n  ```\n\n  - 配置grub.cfg\n  ```bash\n  grub-mkconfig -o /boot/grub/grub.cfg\n  ```\n### 系统初始化设置\n\n  - 设置时区\n  ```bash\n  ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n  hwclock --systohc\n  ```\n  - 本地化\n  ```bash\n  locale-gen\n  ```\n\n  -- 移动设备最小化磁盘访问,把日志放到内存\n  修改`/etc/systemd/journald.conf.d/usbstick.conf`\n  写入\n  ```bash\n  [Journal]\n  Storage=volatile\n  RuntimeMaxUse=30M\n  ```\n\n  - initramfs\n  如果是移动设备，将`/etc/mkinitcpio.conf`中`HOOKS`里面的`block`和`keyboard`放到`autodetect`前面，然后\n  ```bash\n  mkinitcpio -P\n  ```\n\n  创建`/etc/locale.conf`,设置`LANG=en_US.UTF-8`\n  - hostname\n  创建`/etc/hostname`,写入主机名\n  - root密码\n  ```bash\n  passwd\n  ```\n  - hosts\n  向`/etc/hosts`写入\n  ```bash\n  127.0.0.1 localhost\n  ::1 localhost\n  127.0.0.1 {hostname}\n  ```\n\n  - 安装网络工具\n  \n  *networkmanager已经不使用dhcpcd, 因此需要安装dhclient\n  ```bash\n  pacman -S iw wpa_supplicant dialog dhcpcd dhclient netctl networkmanager network-manager-applet gnome-keyring\n  # 设置网络开机启动\n  systemctl enable NetworkManager.service\n  ```\n  - 新增用户\n  ```bash\n  useradd -m -G users,audio,lp,optical,storage,video,wheel,power -s /bin/bash 普通用户名\n  passwd 普通用户名\n  ```\n  运行`visudo`, 去掉`%wheel ALL=(ALL) ALL`注释\n\n**到这里基本已经完成最小系统的配置和安装，在继续之前，改启动项然后reboot**\n\n## DE/WM/DM\n\n  - 安装xorg\n  ```bash\n  sudo pacman -S xorg xorg-xinit\n  ## 移动设备要安装\n  # xf86-input-synaptics 支持触控板\n  # xf86-video-vesa, xf86-video-ati, xf86-video-intel, xf86-video-amdgpu, xf86-video-nouveau and xf86-video-fbdev. 大多数的开源显卡驱动\n  #  libeatmydata  可以禁用fsync，比如对于firefox：eatmydata firefox\n  ```\n  - 安装字体\n  ```bash\n  sudo pacman -S terminus-font \n  ```\n  - 安装DE\n    - Mate\n      - 安装mate\n      ```bash\n      sudo pacman -S mate mate-extra\n      ```\n      - 配置xinitrc\n      ```bash\n      cp /etc/X11/xinit/xinitrc ~/.xinitrc\n      ```\n      把最后的启动换成`exec mate-session`\n    - XFCE\n      - 安装xfce\n      ```bash\n      sudo pacman -S xfce4 xfce4-goodies\n      ```\n      - 配置xinitrc\n      ```bash\n      cp /etc/X11/xinit/xinitrc ~/.xinitrc\n      ```\n      把最后的启动换成`exec startxfce4`\n\n  - 仅安装WM\n    \n    *(略)*\n    \n  - 安装DM\n    - lightdm\n    ```bash\n      sudo pacman -S lightdm-gtk-greeter\n    ```\n\n## 其他\n### 支持hyper-v增强模式\n  ```bash\n  git clone https://www.github.com/Microsoft/linux-vm-tools\n  cd linux-vm-tools/arch\n  # 要先开代理\n  ./make...\n  ./install...\n  ```\n然后记得在win中用管理员设置\n```cmd\nSet-VM -VMName <your_vm_name>  -EnhancedSessionTransportType HvSocket\n```\n\n  **如果无法通过增强模式连接**\n\n  [arch wiki [loginctl or systemctl --user not working]](https://wiki.archlinux.org/title/Xrdp#loginctl_or_systemctl_--user_not_working)\n  \n  Try commenting out all the references to `systemd-home` in `/etc/pam.d/system-auth`, see [github issue](https://github.com/neutrinolabs/xrdp/issues/1684)\n\n### alias\n```bash\nalias s='sudo'\nalias ls='ls --color=auto'\nalias la='ls -a --color=auto'\nalias ll='ls -l --color=auto'\nalias lla='ls -l -a --color=auto'\nalias pac='pacman -S'\nalias pacyu='pacman -Syu'\nalias spac='sudo pacman -S'\nalias spacyu='sudo pacman -Syu'\nalias v='vim'\nalias sv='sudo vim'\n\n```\n### rsync备份\n- 安装rsync\n```bash\nsudo pacman -S rsync\n```\n- backup.sh\n```bash\n#!/bin/bash\necho '==> start to backup... type device:' && \\\n\tread device && \\\n\techo '==> type mount dir:' && \\\n\tread mount_dir && \\\n\techo '==> umount $device...'; \\\n\tumount $device;\\\n\techo '==> umount /mnt/$mount_dir...'; \\\n\tumount /mnt/$mount_dir; \n\techo '==> remove /mnt/$mount_dir...'; \\\n\trm -rf /mnt/$mount_dir && \\\n\techo '==> create directory /mnt/$mount_dir...'; \\\n\tmkdir /mnt/$mount_dir; \\\n\techo '==> mount $device to /mnt/$mount_dir...'; \\\n\tmount $device /mnt/$mount_dir; \\\n\techo '==> create direcotry /mnt/$mount_dir/system_bakcup...'; \\\n\tmkdir /mnt/$mount_dir/system_backup;\n\techo '==> start to sync files to /mnt/$mount_dir/system_backup...'; \\\n\trsync --archive --one-file-system --hard-links \\\n\t--acls --xattrs --sparse \\\n\t--human-readable --numeric-ids --delete --delete-excluded \\\n\t--itemize-changes --verbose --progress \\\n\t--exclude='*~' \\\n\t--exclude='$device' \\\n\t--exclude='/mnt' \\\n\t--exclude='/dev' \\\n\t--exclude='/var/tmp' \\\n\t--exclude='/tmp' \\\n\t/ /mnt/$mount_dir/system_backup && \\\necho '==> finished.'\n```\n\n### 中文及字体设置\n- 语言配置\n去掉`/etc/locale.gen`中的`zh_CN.UTF-8 UTF-8`和`en_US.UTF-8 UTF-8`的注释\n\n根据需要在`~/.xinitrc`或者`~/.bashrc`配置\n\n**在`~/.xinitrc`中配置要注意在`exec xxx`之前**\n```bash\nexport LANG=zh_CN.UTF-8\nexport LANGUAGE=zh_CN:en_US\n```\n- 字体配置\n```bash\nsudo pacman -S wqy-bitmapfont wqy-microhei noto-fonts noto-fonts-emoji\n```\n设置`~/.config/fontconfig/fonts.conf`\n```xml\n<?xml version=\"1.0\"?>\n<!DOCTYPE fontconfig SYSTEM 'fonts.dtd'>\n<fontconfig>\n\n  <!-- 显示器使用的像素排列方式 -->\n  <match target=\"font\">\n    <edit mode=\"assign\" name=\"rgba\">\n      <const>rgb</const>\n    </edit>\n  </match>\n\n  <!-- 字体微调的程度, 可选 hintnone, hintslight (默认), hintmedium, hintfull. -->\n  <!-- 更高的 hinting 等级可使字体更锐利，同时也会损失更多的细节 -->\n  <!-- 如果显示器的 DPI 高得不像话 (>=300), 可关闭 hinting, 字体会自然对齐像素 -->\n  <match target=\"font\">\n    <edit mode=\"assign\" name=\"hintstyle\">\n      <const>hintslight</const>\n    </edit>\n  </match>\n\n  <!-- 抗锯齿. 除非屏幕DPI奇高否则建议开启 -->\n  <match target=\"font\">\n    <edit mode=\"assign\" name=\"antialias\">\n      <bool>true</bool>\n    </edit>\n  </match>\n\n\n<!-- 全局默认字体　-->\n  <match>\n    <edit mode=\"prepend\" name=\"family\">\n      <string>Terminus</string>\n    </edit>\n  </match>\n\n<!-- 全局默认英文字体 -->\n  <match>\n    <test compare=\"contains\" name=\"lang\">\n      <string>en</string>\n    </test>\n    <edit mode=\"prepend\" name=\"family\">\n      <string>Terminus</string>\n    </edit>\n  </match>\n\n<!-- 全局默认中文字体 -->\n  <match>\n    <test compare=\"contains\" name=\"lang\">\n      <string>zh</string>\n    </test>\n    <edit mode=\"prepend\" name=\"family\">\n      <string>WenQuanYi WenQuanYi Bitmap Song</string>\n    </edit>\n  </match>\n\n<!-- 默认无衬线字体 -->\n  <match target=\"pattern\">\n    <test qual=\"any\" name=\"family\">\n      <string>sans-serif</string></test>\n    <edit name=\"family\" mode=\"prepend\" binding=\"same\">\n      <string>Terminus</string>\n    </edit>\n  </match>\n\n<!-- 默认衬线字体 -->\n  <match target=\"pattern\">\n    <test qual=\"any\" name=\"family\">\n      <string>serif</string>\n    </test>\n    <edit name=\"family\" mode=\"prepend\" binding=\"same\">\n      <string>Terminus</string>\n    </edit>\n  </match>\n\n<!-- 默认等宽字体 -->\n  <match target=\"pattern\">\n    <test qual=\"any\" name=\"family\">\n      <string>monospace</string>\n    </test>\n    <edit name=\"family\" mode=\"prepend\" binding=\"same\">\n      <string>Terminus</string>\n    </edit>\n  </match>\n\n  <!-- 字体替换 -->\n  <!--SimSun, Microsoft YaHei, SimHei -> WenQuanYi Micro Hei -->\n  <match target=\"pattern\">\n      <test name=\"family\">\n          <string>宋体</string>\n      </test>\n      <edit name=\"family\" mode=\"assign\" binding=\"strong\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n          <!-- <string>Noto Serif CJK SC</string> -->\n      </edit>\n  </match>\n  <match target=\"pattern\">\n      <test name=\"family\">\n          <string>SimSun</string>\n      </test>\n      <edit name=\"family\" mode=\"assign\" binding=\"strong\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n          <!-- <string>Noto Serif CJK SC</string> -->\n      </edit>\n  </match>\n  <match target=\"pattern\">\n      <test qual=\"any\" name=\"family\">\n          <string>SimSun-18030</string>\n      </test>\n      <edit name=\"family\" mode=\"assign\" binding=\"same\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n         <!-- <string>Noto Serif CJK SC</string> -->\n      </edit>\n  </match>\n\n  <match target=\"pattern\">\n    <test qual=\"any\" name=\"family\">\n        <string>Microsoft YaHei</string>\n    </test>\n    <edit name=\"family\" mode=\"assign\" binding=\"same\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n      </edit>\n  </match>\n\n<match target=\"pattern\">\n    <test qual=\"any\" name=\"family\">\n        <string>SimHei</string>\n    </test>\n    <edit name=\"family\" mode=\"assign\" binding=\"same\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n      </edit>\n  </match>\n\n  <match target=\"pattern\">\n      <test name=\"family\">\n          <string>Times New Roman</string>\n      </test>\n      <edit name=\"family\" mode=\"append\" binding=\"strong\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n      </edit>\n  </match>\n  <match target=\"pattern\">\n      <test name=\"family\">\n          <string>Terminus</string>\n      </test>\n      <edit name=\"family\" mode=\"append\" binding=\"strong\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n      </edit>\n  </match>\n\n\n<!-- 备用字体优先顺序 -->\n  <alias>\n    <family>sans-serif</family>\n    <prefer>\n      <family>Terminus</family>\n      <family>WenQuanYi WenQuanYi Bitmap Song</family>\n      <family>Noto Color Emoji</family>\n      <family>Noto Emoji</family>\n      <family>Noto Sans</family>\n      <family>Noto Sans CJK SC</family>\n      <family>Noto Sans CJK TC</family>\n      <family>Noto Sans CJK JP</family>\n      <family>Noto Sans CJK KR</family>\n    </prefer>\n  </alias>\n  <alias>\n    <family>serif</family>\n    <prefer>\n      <family>Terminus</family>\n      <family>WenQuanYi WenQuanYi Bitmap Song</family>\n      <family>Noto Color Emoji</family>\n      <family>Noto Emoji</family>\n      <family>Noto Sans</family>\n      <family>Noto Sans CJK SC</family>\n      <family>Noto Sans CJK TC</family>\n      <family>Noto Sans CJK JP</family>\n      <family>Noto Sans CJK KR</family>\n      <family>Noto Emoji</family>\n    </prefer>\n  </alias>\n  <alias>\n    <family>monospace</family>\n    <prefer>\n      <family>Terminus</family>\n      <family>WenQuanYi WenQuanYi Bitmap Song</family>\n      <family>Noto Color Emoji</family>\n      <family>Noto Emoji</family>\n      <family>Noto Sans</family>\n      <family>Noto Sans CJK SC</family>\n      <family>Noto Sans CJK TC</family>\n      <family>Noto Sans CJK JP</family>\n      <family>Noto Sans CJK KR</family>\n    </prefer>\n  </alias>\n\n</fontconfig>\n```\n设置字体偏好:`/etc/fonts/conf.d/64-language-selector-prefer.conf`\n```xml\n<?xml version=\"1.0\"?>\n<!DOCTYPE fontconfig SYSTEM 'fonts.dtd'>\n<fontconfig>  \n<alias>\n    <family>sans-serif</family>\n    <prefer>\n      <family>Terminus</family>\n      <family>WenQuanYi WenQuanYi Bitmap Song</family>\n      <family>Noto Color Emoji</family>\n      <family>Noto Emoji</family>\n      <family>Noto Sans</family>\n      <family>Noto Sans CJK SC</family>\n      <family>Noto Sans CJK TC</family>\n      <family>Noto Sans CJK JP</family>\n      <family>Noto Sans CJK KR</family>\n    </prefer>\n  </alias>\n  <alias>\n    <family>serif</family>\n    <prefer>\n      <family>Terminus</family>\n      <family>WenQuanYi WenQuanYi Bitmap Song</family>\n      <family>Noto Color Emoji</family>\n      <family>Noto Emoji</family>\n      <family>Noto Sans</family>\n      <family>Noto Sans CJK SC</family>\n      <family>Noto Sans CJK TC</family>\n      <family>Noto Sans CJK JP</family>\n      <family>Noto Sans CJK KR</family>\n      <family>Noto Emoji</family>\n    </prefer>\n  </alias>\n  <alias>\n    <family>monospace</family>\n    <prefer>\n      <family>Terminus</family>\n      <family>WenQuanYi WenQuanYi Bitmap Song</family>\n      <family>Noto Color Emoji</family>\n      <family>Noto Emoji</family>\n      <family>Noto Sans</family>\n      <family>Noto Sans CJK SC</family>\n      <family>Noto Sans CJK TC</family>\n      <family>Noto Sans CJK JP</family>\n      <family>Noto Sans CJK KR</family>\n    </prefer>\n  </alias>\n</fontconfig>\n\n\n```\n\n### 安装fcitx5\n```bash\nsudo pacman -S fcitx5-im fcitx5-chinese-addons fcitx5-mozc\n```\n\n### xfce的声音\n```bash\n sudo pacman -S alsa-utils pulseaudio pulseaudio-alsa \\\n  pavucontrol      #与xfce4 panel里面的插件配合使用,必须要有这个进程\n```\nxfce4 panel设置里面添加一个pulseaudio plugin的插件\n\n`alsamixer` F6选择声卡,然后把mm的M键去掉,上下箭头调节,auto-mute disable了以后,loopback enable. reboot重启,这时候xfce4的插件就可以调节声音了\n\n### 安装chrome\n```bash\n#AUR 助手\ngit clone https://aur.archlinux.org/yay-git.git\ncd yay-git\nmakepkg -si\n\n#yay不要用root\nyay -S google-chrome\n\n#升级\nyay -Syu\n```\n\n### 安装clash\n\n看[这](https://blog.linioi.com/posts/clash-on-arch/)\n或者[class for windows](https://github.com/Fndroid/clash_for_windows_pkg/releases)\n\n\n### 支持ntfs\n```bash\nsudo pacman -S ntfs-3g\n```","source":"_posts/arch-linux-setup-guide.md","raw":"---\ntitle: Arch Linux Setup\ndate: 2022-04-19 11:23:08\ncategories: \n\t- Linux\ntags:\n\t- setup\n\t- Arch Linux\n\t- Linux\n---\n> https://wiki.archlinux.org/\n\n## 基本系统安装\n### 前置准备\n- 检查网络\n  ```bash \n  ip link\n  ```\n- 更新系统时间\n  ```bash\n  timedatectl set-ntp true\n  ```\n### 准备磁盘\n- 分区\n  - 查看当前磁盘信息\n  ```bash\n  fdisk -l\n  ```\n  - 进入分区\n  ```bash\n  fdisk /dev/the_disk_to_be_partitioned（要被分区的磁盘）\n  ```\n  uefi参考：\n  | 挂载点 | 分区 | 分区类型 | 大小 |\n  | -- | -- | -- | -- |\n  | /mnt/boot/EFI| /dev/efi_system_partition | EFI系统分区 | 300M |\n  | \\[swap\\] **移动设备建议不要**| /dev/swap_partition/ |Linux swap (交换空间) | > 512M (2G if physical ram > 4G) |\n  | /mnt| /dev/root_partition | Linux x86-64 根目录 (/) | 剩余空间 |\n\n  - *移动设备的情况下:*\n    | 挂载点 | 分区 | 分区类型 | 大小 |\n    | -- | -- | -- | -- |\n    | *none* | *none* | BIOS启动分区 | 1M |\n    | /mnt/boot/EFI| /dev/efi_system_partition | EFI系统分区 | 300M |\n    | /mnt| /dev/root_partition | Linux x86-64 根目录 (/) | 剩余空间 |\n\n  - 格式化分区\n  ```bash\n   mkfs.ext4 /dev/root_partition（根分区）\n   # 移动设备关闭日志 mkfs.ext4 -O \"^has_journal\" /dev/root_partition（根分区）\n   mkswap /dev/swap_partition（交换空间分区）\n   mkfs.fat -F 32 /dev/efi_system_partition\n  ```\n  - 挂载分区&启用交换空间\n  ```bash\n  mount /dev/root_partition（根分区） /mnt\n  mount /dev/efi_system_partition /mnt/boot/efi\n  swapon /dev/swap_partition（交换空间分区）\n  ```\n### 安装系统\n  - 设置cn源\n    \n    第一种方法\n      ```bash\n      #!/bin/bash\n      curl 'https://archlinux.org/mirrorlist/?country=CN&prototcol=http&protocol=https&ip_version=4' > /etc/pacman.d/mirrorlist && \\\n      echo /etc/pacman.d/mirrorlist && \\\n      sudo vim /etc/pacman.d/mirrorlist && \\\n      echo 'pacman mirror list updated'\n      ```\n      然后将`/etc/pacman.d/mirrorlist`中注释去掉\n        \n    第二种方法\n\n    在`/etc/pacman.d/mirrorlist`中搜索CN，放到最前面，推荐aliyun的源\n\n  - 安装系统&软件包\n  ```bash\n  pacstrap /mnt base base-devel linux linux-firmware vim vi sudo git\n  # 移动设备 可以使用基于BFQ的io调度内核linux-zen，把linux换成linux-zen\n  ```\n  *参考：[BFQ](https://www.kernel.org/doc/html/latest/block/bfq-iosched.html)*\n\n## 系统配置\n### 系统引导\n  - 配置fstab\n  ```bash\n  genfstab -U /mnt >> /mnt/etc/fstab\n  ```\n  - 安装grub\n  ```bash\n  pacman -S efibootmgr grub\n\n  # uefi\n  grub-install --target=x86_64-efi --efi-directory={挂载点,如/mnt/boot/EFI} --bootloader-id=GRUB\n\n  # bios(非GPT分区无需其他空间，但GPT分区需要有一块1M的BIOS boot分区)\n  grub-install --target=i386-pc /dev/sdX\n  ```\n  *移动设备的情况下*\n\n  假设分区顺序是：\n    - BIOS\n    - EFI\n    - root\n  要先在这块设备上写入引导信息，运行`gdisk /dev/sdX`\n\n  ```bash\n  # gdisk /dev/sdX\n\n  Command (? for help): r\n  Recovery/transformation command (? for help): h\n\n  WARNING! Hybrid MBRs are flaky and dangerous! If you decide not to use one,\n  just hit the Enter key at the below prompt and your MBR partition table will\n  be untouched.\n\n  Type from one to three GPT partition numbers, separated by spaces, to be added to the hybrid MBR, in sequence: 1 2 3\n  Place EFI GPT (0xEE) partition first in MBR (good for GRUB)? (Y/N): N\n\n  Creating entry for GPT partition #1 (MBR partition #1)\n  Enter an MBR hex code (default EF): \n  Set the bootable flag? (Y/N): N\n\n  Creating entry for GPT partition #2 (MBR partition #2)\n  Enter an MBR hex code (default EF): \n  Set the bootable flag? (Y/N): N\n\n  Creating entry for GPT partition #3 (MBR partition #3)\n  Enter an MBR hex code (default 83): \n  Set the bootable flag? (Y/N): Y\n\n  Recovery/transformation command (? for help): x\n  Expert command (? for help): h\n  Expert command (? for help): w\n\n  Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING\n  PARTITIONS!!\n\n  Do you want to proceed? (Y/N): Y\n  ```\n  \n  > **如果不需要兼容，不用做这一步，混合分区会在设备上存在两个分区表，系统识别这个设备分区的时候具体的行为完全依赖于系统的实现，非常不稳定**\n\n  > **注意：写完hybrid之后，默认的windows中就只认MBR分区，假设分区按上面的例子，且还有一个4号分区，那么由于MBR的限制**\n  > **在windows中第四个分区是无法正确识别文件系统的，如果要使用第四个分区且要通过MBR引导，那么这里就要在MBR写入134分区**\n  > **ESP分区可以不用写到MBR里**\n\n\n  ```bash\n  pacman -S efibootmgr grub amd-ucode intel-ucode\n\n  # uefi + MBR(BIOS)混合启动\n  grub-install --target=x86_64-efi --efi-directory={挂载点,如/mnt/boot/EFI} --removable\n   --bootloader-id=GRUB --boot-directory={root挂载点,如/mnt}/boot\n\n  grub-install --target=i386-pc --recheck --boot-directory=/DATA_MOUNTPOINT/boot /dev/sdX #注意这里是整个设备\n\n  # 作为保险\n  grub-install --target=i386-pc --recheck --boot-directory=/DATA_MOUNTPOINT/boot /dev/{root的那个分区}\n  ```\n  - 切换到已经安装的系统\n  ```bash\n  arch-chroot /mnt\n  ```\n\n  - 配置grub.cfg\n  ```bash\n  grub-mkconfig -o /boot/grub/grub.cfg\n  ```\n### 系统初始化设置\n\n  - 设置时区\n  ```bash\n  ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n  hwclock --systohc\n  ```\n  - 本地化\n  ```bash\n  locale-gen\n  ```\n\n  -- 移动设备最小化磁盘访问,把日志放到内存\n  修改`/etc/systemd/journald.conf.d/usbstick.conf`\n  写入\n  ```bash\n  [Journal]\n  Storage=volatile\n  RuntimeMaxUse=30M\n  ```\n\n  - initramfs\n  如果是移动设备，将`/etc/mkinitcpio.conf`中`HOOKS`里面的`block`和`keyboard`放到`autodetect`前面，然后\n  ```bash\n  mkinitcpio -P\n  ```\n\n  创建`/etc/locale.conf`,设置`LANG=en_US.UTF-8`\n  - hostname\n  创建`/etc/hostname`,写入主机名\n  - root密码\n  ```bash\n  passwd\n  ```\n  - hosts\n  向`/etc/hosts`写入\n  ```bash\n  127.0.0.1 localhost\n  ::1 localhost\n  127.0.0.1 {hostname}\n  ```\n\n  - 安装网络工具\n  \n  *networkmanager已经不使用dhcpcd, 因此需要安装dhclient\n  ```bash\n  pacman -S iw wpa_supplicant dialog dhcpcd dhclient netctl networkmanager network-manager-applet gnome-keyring\n  # 设置网络开机启动\n  systemctl enable NetworkManager.service\n  ```\n  - 新增用户\n  ```bash\n  useradd -m -G users,audio,lp,optical,storage,video,wheel,power -s /bin/bash 普通用户名\n  passwd 普通用户名\n  ```\n  运行`visudo`, 去掉`%wheel ALL=(ALL) ALL`注释\n\n**到这里基本已经完成最小系统的配置和安装，在继续之前，改启动项然后reboot**\n\n## DE/WM/DM\n\n  - 安装xorg\n  ```bash\n  sudo pacman -S xorg xorg-xinit\n  ## 移动设备要安装\n  # xf86-input-synaptics 支持触控板\n  # xf86-video-vesa, xf86-video-ati, xf86-video-intel, xf86-video-amdgpu, xf86-video-nouveau and xf86-video-fbdev. 大多数的开源显卡驱动\n  #  libeatmydata  可以禁用fsync，比如对于firefox：eatmydata firefox\n  ```\n  - 安装字体\n  ```bash\n  sudo pacman -S terminus-font \n  ```\n  - 安装DE\n    - Mate\n      - 安装mate\n      ```bash\n      sudo pacman -S mate mate-extra\n      ```\n      - 配置xinitrc\n      ```bash\n      cp /etc/X11/xinit/xinitrc ~/.xinitrc\n      ```\n      把最后的启动换成`exec mate-session`\n    - XFCE\n      - 安装xfce\n      ```bash\n      sudo pacman -S xfce4 xfce4-goodies\n      ```\n      - 配置xinitrc\n      ```bash\n      cp /etc/X11/xinit/xinitrc ~/.xinitrc\n      ```\n      把最后的启动换成`exec startxfce4`\n\n  - 仅安装WM\n    \n    *(略)*\n    \n  - 安装DM\n    - lightdm\n    ```bash\n      sudo pacman -S lightdm-gtk-greeter\n    ```\n\n## 其他\n### 支持hyper-v增强模式\n  ```bash\n  git clone https://www.github.com/Microsoft/linux-vm-tools\n  cd linux-vm-tools/arch\n  # 要先开代理\n  ./make...\n  ./install...\n  ```\n然后记得在win中用管理员设置\n```cmd\nSet-VM -VMName <your_vm_name>  -EnhancedSessionTransportType HvSocket\n```\n\n  **如果无法通过增强模式连接**\n\n  [arch wiki [loginctl or systemctl --user not working]](https://wiki.archlinux.org/title/Xrdp#loginctl_or_systemctl_--user_not_working)\n  \n  Try commenting out all the references to `systemd-home` in `/etc/pam.d/system-auth`, see [github issue](https://github.com/neutrinolabs/xrdp/issues/1684)\n\n### alias\n```bash\nalias s='sudo'\nalias ls='ls --color=auto'\nalias la='ls -a --color=auto'\nalias ll='ls -l --color=auto'\nalias lla='ls -l -a --color=auto'\nalias pac='pacman -S'\nalias pacyu='pacman -Syu'\nalias spac='sudo pacman -S'\nalias spacyu='sudo pacman -Syu'\nalias v='vim'\nalias sv='sudo vim'\n\n```\n### rsync备份\n- 安装rsync\n```bash\nsudo pacman -S rsync\n```\n- backup.sh\n```bash\n#!/bin/bash\necho '==> start to backup... type device:' && \\\n\tread device && \\\n\techo '==> type mount dir:' && \\\n\tread mount_dir && \\\n\techo '==> umount $device...'; \\\n\tumount $device;\\\n\techo '==> umount /mnt/$mount_dir...'; \\\n\tumount /mnt/$mount_dir; \n\techo '==> remove /mnt/$mount_dir...'; \\\n\trm -rf /mnt/$mount_dir && \\\n\techo '==> create directory /mnt/$mount_dir...'; \\\n\tmkdir /mnt/$mount_dir; \\\n\techo '==> mount $device to /mnt/$mount_dir...'; \\\n\tmount $device /mnt/$mount_dir; \\\n\techo '==> create direcotry /mnt/$mount_dir/system_bakcup...'; \\\n\tmkdir /mnt/$mount_dir/system_backup;\n\techo '==> start to sync files to /mnt/$mount_dir/system_backup...'; \\\n\trsync --archive --one-file-system --hard-links \\\n\t--acls --xattrs --sparse \\\n\t--human-readable --numeric-ids --delete --delete-excluded \\\n\t--itemize-changes --verbose --progress \\\n\t--exclude='*~' \\\n\t--exclude='$device' \\\n\t--exclude='/mnt' \\\n\t--exclude='/dev' \\\n\t--exclude='/var/tmp' \\\n\t--exclude='/tmp' \\\n\t/ /mnt/$mount_dir/system_backup && \\\necho '==> finished.'\n```\n\n### 中文及字体设置\n- 语言配置\n去掉`/etc/locale.gen`中的`zh_CN.UTF-8 UTF-8`和`en_US.UTF-8 UTF-8`的注释\n\n根据需要在`~/.xinitrc`或者`~/.bashrc`配置\n\n**在`~/.xinitrc`中配置要注意在`exec xxx`之前**\n```bash\nexport LANG=zh_CN.UTF-8\nexport LANGUAGE=zh_CN:en_US\n```\n- 字体配置\n```bash\nsudo pacman -S wqy-bitmapfont wqy-microhei noto-fonts noto-fonts-emoji\n```\n设置`~/.config/fontconfig/fonts.conf`\n```xml\n<?xml version=\"1.0\"?>\n<!DOCTYPE fontconfig SYSTEM 'fonts.dtd'>\n<fontconfig>\n\n  <!-- 显示器使用的像素排列方式 -->\n  <match target=\"font\">\n    <edit mode=\"assign\" name=\"rgba\">\n      <const>rgb</const>\n    </edit>\n  </match>\n\n  <!-- 字体微调的程度, 可选 hintnone, hintslight (默认), hintmedium, hintfull. -->\n  <!-- 更高的 hinting 等级可使字体更锐利，同时也会损失更多的细节 -->\n  <!-- 如果显示器的 DPI 高得不像话 (>=300), 可关闭 hinting, 字体会自然对齐像素 -->\n  <match target=\"font\">\n    <edit mode=\"assign\" name=\"hintstyle\">\n      <const>hintslight</const>\n    </edit>\n  </match>\n\n  <!-- 抗锯齿. 除非屏幕DPI奇高否则建议开启 -->\n  <match target=\"font\">\n    <edit mode=\"assign\" name=\"antialias\">\n      <bool>true</bool>\n    </edit>\n  </match>\n\n\n<!-- 全局默认字体　-->\n  <match>\n    <edit mode=\"prepend\" name=\"family\">\n      <string>Terminus</string>\n    </edit>\n  </match>\n\n<!-- 全局默认英文字体 -->\n  <match>\n    <test compare=\"contains\" name=\"lang\">\n      <string>en</string>\n    </test>\n    <edit mode=\"prepend\" name=\"family\">\n      <string>Terminus</string>\n    </edit>\n  </match>\n\n<!-- 全局默认中文字体 -->\n  <match>\n    <test compare=\"contains\" name=\"lang\">\n      <string>zh</string>\n    </test>\n    <edit mode=\"prepend\" name=\"family\">\n      <string>WenQuanYi WenQuanYi Bitmap Song</string>\n    </edit>\n  </match>\n\n<!-- 默认无衬线字体 -->\n  <match target=\"pattern\">\n    <test qual=\"any\" name=\"family\">\n      <string>sans-serif</string></test>\n    <edit name=\"family\" mode=\"prepend\" binding=\"same\">\n      <string>Terminus</string>\n    </edit>\n  </match>\n\n<!-- 默认衬线字体 -->\n  <match target=\"pattern\">\n    <test qual=\"any\" name=\"family\">\n      <string>serif</string>\n    </test>\n    <edit name=\"family\" mode=\"prepend\" binding=\"same\">\n      <string>Terminus</string>\n    </edit>\n  </match>\n\n<!-- 默认等宽字体 -->\n  <match target=\"pattern\">\n    <test qual=\"any\" name=\"family\">\n      <string>monospace</string>\n    </test>\n    <edit name=\"family\" mode=\"prepend\" binding=\"same\">\n      <string>Terminus</string>\n    </edit>\n  </match>\n\n  <!-- 字体替换 -->\n  <!--SimSun, Microsoft YaHei, SimHei -> WenQuanYi Micro Hei -->\n  <match target=\"pattern\">\n      <test name=\"family\">\n          <string>宋体</string>\n      </test>\n      <edit name=\"family\" mode=\"assign\" binding=\"strong\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n          <!-- <string>Noto Serif CJK SC</string> -->\n      </edit>\n  </match>\n  <match target=\"pattern\">\n      <test name=\"family\">\n          <string>SimSun</string>\n      </test>\n      <edit name=\"family\" mode=\"assign\" binding=\"strong\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n          <!-- <string>Noto Serif CJK SC</string> -->\n      </edit>\n  </match>\n  <match target=\"pattern\">\n      <test qual=\"any\" name=\"family\">\n          <string>SimSun-18030</string>\n      </test>\n      <edit name=\"family\" mode=\"assign\" binding=\"same\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n         <!-- <string>Noto Serif CJK SC</string> -->\n      </edit>\n  </match>\n\n  <match target=\"pattern\">\n    <test qual=\"any\" name=\"family\">\n        <string>Microsoft YaHei</string>\n    </test>\n    <edit name=\"family\" mode=\"assign\" binding=\"same\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n      </edit>\n  </match>\n\n<match target=\"pattern\">\n    <test qual=\"any\" name=\"family\">\n        <string>SimHei</string>\n    </test>\n    <edit name=\"family\" mode=\"assign\" binding=\"same\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n      </edit>\n  </match>\n\n  <match target=\"pattern\">\n      <test name=\"family\">\n          <string>Times New Roman</string>\n      </test>\n      <edit name=\"family\" mode=\"append\" binding=\"strong\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n      </edit>\n  </match>\n  <match target=\"pattern\">\n      <test name=\"family\">\n          <string>Terminus</string>\n      </test>\n      <edit name=\"family\" mode=\"append\" binding=\"strong\">\n          <string>WenQuanYi WenQuanYi Bitmap Song</string>\n      </edit>\n  </match>\n\n\n<!-- 备用字体优先顺序 -->\n  <alias>\n    <family>sans-serif</family>\n    <prefer>\n      <family>Terminus</family>\n      <family>WenQuanYi WenQuanYi Bitmap Song</family>\n      <family>Noto Color Emoji</family>\n      <family>Noto Emoji</family>\n      <family>Noto Sans</family>\n      <family>Noto Sans CJK SC</family>\n      <family>Noto Sans CJK TC</family>\n      <family>Noto Sans CJK JP</family>\n      <family>Noto Sans CJK KR</family>\n    </prefer>\n  </alias>\n  <alias>\n    <family>serif</family>\n    <prefer>\n      <family>Terminus</family>\n      <family>WenQuanYi WenQuanYi Bitmap Song</family>\n      <family>Noto Color Emoji</family>\n      <family>Noto Emoji</family>\n      <family>Noto Sans</family>\n      <family>Noto Sans CJK SC</family>\n      <family>Noto Sans CJK TC</family>\n      <family>Noto Sans CJK JP</family>\n      <family>Noto Sans CJK KR</family>\n      <family>Noto Emoji</family>\n    </prefer>\n  </alias>\n  <alias>\n    <family>monospace</family>\n    <prefer>\n      <family>Terminus</family>\n      <family>WenQuanYi WenQuanYi Bitmap Song</family>\n      <family>Noto Color Emoji</family>\n      <family>Noto Emoji</family>\n      <family>Noto Sans</family>\n      <family>Noto Sans CJK SC</family>\n      <family>Noto Sans CJK TC</family>\n      <family>Noto Sans CJK JP</family>\n      <family>Noto Sans CJK KR</family>\n    </prefer>\n  </alias>\n\n</fontconfig>\n```\n设置字体偏好:`/etc/fonts/conf.d/64-language-selector-prefer.conf`\n```xml\n<?xml version=\"1.0\"?>\n<!DOCTYPE fontconfig SYSTEM 'fonts.dtd'>\n<fontconfig>  \n<alias>\n    <family>sans-serif</family>\n    <prefer>\n      <family>Terminus</family>\n      <family>WenQuanYi WenQuanYi Bitmap Song</family>\n      <family>Noto Color Emoji</family>\n      <family>Noto Emoji</family>\n      <family>Noto Sans</family>\n      <family>Noto Sans CJK SC</family>\n      <family>Noto Sans CJK TC</family>\n      <family>Noto Sans CJK JP</family>\n      <family>Noto Sans CJK KR</family>\n    </prefer>\n  </alias>\n  <alias>\n    <family>serif</family>\n    <prefer>\n      <family>Terminus</family>\n      <family>WenQuanYi WenQuanYi Bitmap Song</family>\n      <family>Noto Color Emoji</family>\n      <family>Noto Emoji</family>\n      <family>Noto Sans</family>\n      <family>Noto Sans CJK SC</family>\n      <family>Noto Sans CJK TC</family>\n      <family>Noto Sans CJK JP</family>\n      <family>Noto Sans CJK KR</family>\n      <family>Noto Emoji</family>\n    </prefer>\n  </alias>\n  <alias>\n    <family>monospace</family>\n    <prefer>\n      <family>Terminus</family>\n      <family>WenQuanYi WenQuanYi Bitmap Song</family>\n      <family>Noto Color Emoji</family>\n      <family>Noto Emoji</family>\n      <family>Noto Sans</family>\n      <family>Noto Sans CJK SC</family>\n      <family>Noto Sans CJK TC</family>\n      <family>Noto Sans CJK JP</family>\n      <family>Noto Sans CJK KR</family>\n    </prefer>\n  </alias>\n</fontconfig>\n\n\n```\n\n### 安装fcitx5\n```bash\nsudo pacman -S fcitx5-im fcitx5-chinese-addons fcitx5-mozc\n```\n\n### xfce的声音\n```bash\n sudo pacman -S alsa-utils pulseaudio pulseaudio-alsa \\\n  pavucontrol      #与xfce4 panel里面的插件配合使用,必须要有这个进程\n```\nxfce4 panel设置里面添加一个pulseaudio plugin的插件\n\n`alsamixer` F6选择声卡,然后把mm的M键去掉,上下箭头调节,auto-mute disable了以后,loopback enable. reboot重启,这时候xfce4的插件就可以调节声音了\n\n### 安装chrome\n```bash\n#AUR 助手\ngit clone https://aur.archlinux.org/yay-git.git\ncd yay-git\nmakepkg -si\n\n#yay不要用root\nyay -S google-chrome\n\n#升级\nyay -Syu\n```\n\n### 安装clash\n\n看[这](https://blog.linioi.com/posts/clash-on-arch/)\n或者[class for windows](https://github.com/Fndroid/clash_for_windows_pkg/releases)\n\n\n### 支持ntfs\n```bash\nsudo pacman -S ntfs-3g\n```","slug":"arch-linux-setup-guide","published":1,"updated":"2022-06-13T15:17:25.307Z","_id":"cl4cuks3p0001dooua78r5dx4","comments":1,"layout":"post","photos":[],"link":"","content":"<blockquote>\n<p><a href=\"https://wiki.archlinux.org/\">https://wiki.archlinux.org/</a></p>\n</blockquote>\n<h2 id=\"基本系统安装\"><a href=\"#基本系统安装\" class=\"headerlink\" title=\"基本系统安装\"></a>基本系统安装</h2><h3 id=\"前置准备\"><a href=\"#前置准备\" class=\"headerlink\" title=\"前置准备\"></a>前置准备</h3><ul>\n<li>检查网络<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">ip</span> <span class=\"token function\">link</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li>更新系统时间<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">timedatectl set-ntp <span class=\"token boolean\">true</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"准备磁盘\"><a href=\"#准备磁盘\" class=\"headerlink\" title=\"准备磁盘\"></a>准备磁盘</h3></li>\n<li>分区<ul>\n<li><p>查看当前磁盘信息</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">fdisk</span> -l<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li><p>进入分区</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">fdisk</span> /dev/the_disk_to_be_partitioned（要被分区的磁盘）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>uefi参考：</p>\n<div class=\"table-wrapper\"/>\n<table>\n<thead>\n<tr>\n<th>挂载点</th>\n<th>分区</th>\n<th>分区类型</th>\n<th>大小</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>&#x2F;mnt&#x2F;boot&#x2F;EFI</td>\n<td>&#x2F;dev&#x2F;efi_system_partition</td>\n<td>EFI系统分区</td>\n<td>300M</td>\n</tr>\n<tr>\n<td>[swap] <strong>移动设备建议不要</strong></td>\n<td>&#x2F;dev&#x2F;swap_partition&#x2F;</td>\n<td>Linux swap (交换空间)</td>\n<td>&gt; 512M (2G if physical ram &gt; 4G)</td>\n</tr>\n<tr>\n<td>&#x2F;mnt</td>\n<td>&#x2F;dev&#x2F;root_partition</td>\n<td>Linux x86-64 根目录 (&#x2F;)</td>\n<td>剩余空间</td>\n</tr>\n</tbody></table>\n</div>\n</li>\n<li><p><em>移动设备的情况下:</em></p>\n<div class=\"table-wrapper\"/>\n<table>\n<thead>\n<tr>\n<th>挂载点</th>\n<th>分区</th>\n<th>分区类型</th>\n<th>大小</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><em>none</em></td>\n<td><em>none</em></td>\n<td>BIOS启动分区</td>\n<td>1M</td>\n</tr>\n<tr>\n<td>&#x2F;mnt&#x2F;boot&#x2F;EFI</td>\n<td>&#x2F;dev&#x2F;efi_system_partition</td>\n<td>EFI系统分区</td>\n<td>300M</td>\n</tr>\n<tr>\n<td>&#x2F;mnt</td>\n<td>&#x2F;dev&#x2F;root_partition</td>\n<td>Linux x86-64 根目录 (&#x2F;)</td>\n<td>剩余空间</td>\n</tr>\n</tbody></table>\n</div>\n</li>\n<li><p>格式化分区</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mkfs.ext4 /dev/root_partition（根分区）\n<span class=\"token comment\"># 移动设备关闭日志 mkfs.ext4 -O \"^has_journal\" /dev/root_partition（根分区）</span>\n<span class=\"token function\">mkswap</span> /dev/swap_partition（交换空间分区）\nmkfs.fat -F <span class=\"token number\">32</span> /dev/efi_system_partition<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre></li>\n<li><p>挂载分区&amp;启用交换空间</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mount</span> /dev/root_partition（根分区） /mnt\n<span class=\"token function\">mount</span> /dev/efi_system_partition /mnt/boot/efi\n<span class=\"token function\">swapon</span> /dev/swap_partition（交换空间分区）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"安装系统\"><a href=\"#安装系统\" class=\"headerlink\" title=\"安装系统\"></a>安装系统</h3><ul>\n<li><p>设置cn源</p>\n<p>第一种方法</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token function\">curl</span> <span class=\"token string\">'https://archlinux.org/mirrorlist/?country=CN&amp;prototcol=http&amp;protocol=https&amp;ip_version=4'</span> <span class=\"token operator\">></span> /etc/pacman.d/mirrorlist <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token builtin class-name\">echo</span> /etc/pacman.d/mirrorlist <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">vim</span> /etc/pacman.d/mirrorlist <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'pacman mirror list updated'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>  然后将<code>/etc/pacman.d/mirrorlist</code>中注释去掉</p>\n<p>第二种方法</p>\n<p>在<code>/etc/pacman.d/mirrorlist</code>中搜索CN，放到最前面，推荐aliyun的源</p>\n</li>\n<li><p>安装系统&amp;软件包</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pacstrap /mnt base base-devel linux linux-firmware <span class=\"token function\">vim</span> <span class=\"token function\">vi</span> <span class=\"token function\">sudo</span> <span class=\"token function\">git</span>\n<span class=\"token comment\"># 移动设备 可以使用基于BFQ的io调度内核linux-zen，把linux换成linux-zen</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre></li>\n</ul>\n<p>  <em>参考：<a href=\"https://www.kernel.org/doc/html/latest/block/bfq-iosched.html\">BFQ</a></em></p>\n<h2 id=\"系统配置\"><a href=\"#系统配置\" class=\"headerlink\" title=\"系统配置\"></a>系统配置</h2><h3 id=\"系统引导\"><a href=\"#系统引导\" class=\"headerlink\" title=\"系统引导\"></a>系统引导</h3><ul>\n<li>配置fstab  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">genfstab -U /mnt <span class=\"token operator\">>></span> /mnt/etc/fstab<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li>安装grub  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pacman -S efibootmgr grub\n\n<span class=\"token comment\"># uefi</span>\ngrub-install --target<span class=\"token operator\">=</span>x86_64-efi --efi-directory<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>挂载点,如/mnt/boot/EFI<span class=\"token punctuation\">&#125;</span> --bootloader-id<span class=\"token operator\">=</span>GRUB\n\n<span class=\"token comment\"># bios(非GPT分区无需其他空间，但GPT分区需要有一块1M的BIOS boot分区)</span>\ngrub-install --target<span class=\"token operator\">=</span>i386-pc /dev/sdX<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n</ul>\n<p>  <em>移动设备的情况下</em></p>\n<p>  假设分区顺序是：<br>    - BIOS<br>    - EFI<br>    - root<br>  要先在这块设备上写入引导信息，运行<code>gdisk /dev/sdX</code></p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># gdisk /dev/sdX</span>\n\nCommand <span class=\"token punctuation\">(</span>? <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>: r\nRecovery/transformation <span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">(</span>? <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>: h\n\nWARNING<span class=\"token operator\">!</span> Hybrid MBRs are flaky and dangerous<span class=\"token operator\">!</span> If you decide not to use one,\njust hit the Enter key at the below prompt and your MBR partition table will\nbe untouched.\n\nType from one to three GPT partition numbers, separated by spaces, to be added to the hybrid MBR, <span class=\"token keyword\">in</span> sequence: <span class=\"token number\">1</span> <span class=\"token number\">2</span> <span class=\"token number\">3</span>\nPlace EFI GPT <span class=\"token punctuation\">(</span>0xEE<span class=\"token punctuation\">)</span> partition first <span class=\"token keyword\">in</span> MBR <span class=\"token punctuation\">(</span>good <span class=\"token keyword\">for</span> GRUB<span class=\"token punctuation\">)</span>? <span class=\"token punctuation\">(</span>Y/N<span class=\"token punctuation\">)</span>: N\n\nCreating entry <span class=\"token keyword\">for</span> GPT partition <span class=\"token comment\">#1 (MBR partition #1)</span>\nEnter an MBR hex code <span class=\"token punctuation\">(</span>default EF<span class=\"token punctuation\">)</span>: \nSet the bootable flag? <span class=\"token punctuation\">(</span>Y/N<span class=\"token punctuation\">)</span>: N\n\nCreating entry <span class=\"token keyword\">for</span> GPT partition <span class=\"token comment\">#2 (MBR partition #2)</span>\nEnter an MBR hex code <span class=\"token punctuation\">(</span>default EF<span class=\"token punctuation\">)</span>: \nSet the bootable flag? <span class=\"token punctuation\">(</span>Y/N<span class=\"token punctuation\">)</span>: N\n\nCreating entry <span class=\"token keyword\">for</span> GPT partition <span class=\"token comment\">#3 (MBR partition #3)</span>\nEnter an MBR hex code <span class=\"token punctuation\">(</span>default <span class=\"token number\">83</span><span class=\"token punctuation\">)</span>: \nSet the bootable flag? <span class=\"token punctuation\">(</span>Y/N<span class=\"token punctuation\">)</span>: Y\n\nRecovery/transformation <span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">(</span>? <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>: x\nExpert <span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">(</span>? <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>: h\nExpert <span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">(</span>? <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>: w\n\nFinal checks complete. About to <span class=\"token function\">write</span> GPT data. THIS WILL OVERWRITE EXISTING\nPARTITIONS<span class=\"token operator\">!</span><span class=\"token operator\">!</span>\n\nDo you want to proceed? <span class=\"token punctuation\">(</span>Y/N<span class=\"token punctuation\">)</span>: Y<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p><strong>如果不需要兼容，不用做这一步，混合分区会在设备上存在两个分区表，系统识别这个设备分区的时候具体的行为完全依赖于系统的实现，非常不稳定</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>注意：写完hybrid之后，默认的windows中就只认MBR分区，假设分区按上面的例子，且还有一个4号分区，那么由于MBR的限制</strong><br><strong>在windows中第四个分区是无法正确识别文件系统的，如果要使用第四个分区且要通过MBR引导，那么这里就要在MBR写入134分区</strong><br><strong>ESP分区可以不用写到MBR里</strong></p>\n</blockquote>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pacman -S efibootmgr grub amd-ucode intel-ucode\n\n<span class=\"token comment\"># uefi + MBR(BIOS)混合启动</span>\ngrub-install --target<span class=\"token operator\">=</span>x86_64-efi --efi-directory<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>挂载点,如/mnt/boot/EFI<span class=\"token punctuation\">&#125;</span> --removable\n --bootloader-id<span class=\"token operator\">=</span>GRUB --boot-directory<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>root挂载点,如/mnt<span class=\"token punctuation\">&#125;</span>/boot\n\ngrub-install --target<span class=\"token operator\">=</span>i386-pc --recheck --boot-directory<span class=\"token operator\">=</span>/DATA_MOUNTPOINT/boot /dev/sdX <span class=\"token comment\">#注意这里是整个设备</span>\n\n<span class=\"token comment\"># 作为保险</span>\ngrub-install --target<span class=\"token operator\">=</span>i386-pc --recheck --boot-directory<span class=\"token operator\">=</span>/DATA_MOUNTPOINT/boot /dev/<span class=\"token punctuation\">&#123;</span>root的那个分区<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li><p>切换到已经安装的系统</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">arch-chroot /mnt<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li><p>配置grub.cfg</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">grub-mkconfig</span> -o /boot/grub/grub.cfg<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"系统初始化设置\"><a href=\"#系统初始化设置\" class=\"headerlink\" title=\"系统初始化设置\"></a>系统初始化设置</h3></li>\n<li><p>设置时区</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\nhwclock --systohc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre></li>\n<li><p>本地化</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">locale-gen<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n</ul>\n<p>  – 移动设备最小化磁盘访问,把日志放到内存<br>  修改<code>/etc/systemd/journald.conf.d/usbstick.conf</code><br>  写入<br>  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>Journal<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">Storage</span><span class=\"token operator\">=</span>volatile\n<span class=\"token assign-left variable\">RuntimeMaxUse</span><span class=\"token operator\">=</span>30M<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre></p>\n<ul>\n<li>initramfs<br>  如果是移动设备，将<code>/etc/mkinitcpio.conf</code>中<code>HOOKS</code>里面的<code>block</code>和<code>keyboard</code>放到<code>autodetect</code>前面，然后  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mkinitcpio -P<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n</ul>\n<p>  创建<code>/etc/locale.conf</code>,设置<code>LANG=en_US.UTF-8</code></p>\n<ul>\n<li><p>hostname<br>  创建<code>/etc/hostname</code>,写入主机名</p>\n</li>\n<li><p>root密码</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">passwd</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li><p>hosts<br>  向<code>/etc/hosts</code>写入</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token number\">127.0</span>.0.1 localhost\n::1 localhost\n<span class=\"token number\">127.0</span>.0.1 <span class=\"token punctuation\">&#123;</span>hostname<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>安装网络工具</p>\n</li>\n</ul>\n<p>  *networkmanager已经不使用dhcpcd, 因此需要安装dhclient<br>  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pacman -S iw wpa_supplicant dialog dhcpcd dhclient netctl networkmanager network-manager-applet gnome-keyring\n<span class=\"token comment\"># 设置网络开机启动</span>\nsystemctl <span class=\"token builtin class-name\">enable</span> NetworkManager.service<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre></p>\n<ul>\n<li>新增用户  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">useradd</span> -m -G users,audio,lp,optical,storage,video,wheel,power -s /bin/bash 普通用户名\n<span class=\"token function\">passwd</span> 普通用户名<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n  运行<code>visudo</code>, 去掉<code>%wheel ALL=(ALL) ALL</code>注释</li>\n</ul>\n<p><strong>到这里基本已经完成最小系统的配置和安装，在继续之前，改启动项然后reboot</strong></p>\n<h2 id=\"DE-x2F-WM-x2F-DM\"><a href=\"#DE-x2F-WM-x2F-DM\" class=\"headerlink\" title=\"DE&#x2F;WM&#x2F;DM\"></a>DE&#x2F;WM&#x2F;DM</h2><ul>\n<li><p>安装xorg</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S xorg xorg-xinit\n<span class=\"token comment\">## 移动设备要安装</span>\n<span class=\"token comment\"># xf86-input-synaptics 支持触控板</span>\n<span class=\"token comment\"># xf86-video-vesa, xf86-video-ati, xf86-video-intel, xf86-video-amdgpu, xf86-video-nouveau and xf86-video-fbdev. 大多数的开源显卡驱动</span>\n<span class=\"token comment\">#  libeatmydata  可以禁用fsync，比如对于firefox：eatmydata firefox</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n<li><p>安装字体</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S terminus-font <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li><p>安装DE</p>\n<ul>\n<li>Mate<ul>\n<li>安装mate<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S mate mate-extra<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li>配置xinitrc<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">cp</span> /etc/X11/xinit/xinitrc ~/.xinitrc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n把最后的启动换成<code>exec mate-session</code></li>\n</ul>\n</li>\n<li>XFCE<ul>\n<li>安装xfce<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S xfce4 xfce4-goodies<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li>配置xinitrc<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">cp</span> /etc/X11/xinit/xinitrc ~/.xinitrc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n把最后的启动换成<code>exec startxfce4</code></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>仅安装WM</p>\n<p><em>(略)</em></p>\n</li>\n<li><p>安装DM</p>\n<ul>\n<li>lightdm<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S lightdm-gtk-greeter<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><h3 id=\"支持hyper-v增强模式\"><a href=\"#支持hyper-v增强模式\" class=\"headerlink\" title=\"支持hyper-v增强模式\"></a>支持hyper-v增强模式</h3>  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://www.github.com/Microsoft/linux-vm-tools\n<span class=\"token builtin class-name\">cd</span> linux-vm-tools/arch\n<span class=\"token comment\"># 要先开代理</span>\n./make<span class=\"token punctuation\">..</span>.\n./install<span class=\"token punctuation\">..</span>.<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>然后记得在win中用管理员设置</p>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><code class=\"language-cmd\">Set-VM -VMName &lt;your_vm_name&gt;  -EnhancedSessionTransportType HvSocket<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>  <strong>如果无法通过增强模式连接</strong></p>\n<p>  <a href=\"https://wiki.archlinux.org/title/Xrdp#loginctl_or_systemctl_--user_not_working\">arch wiki [loginctl or systemctl –user not working]</a></p>\n<p>  Try commenting out all the references to <code>systemd-home</code> in <code>/etc/pam.d/system-auth</code>, see <a href=\"https://github.com/neutrinolabs/xrdp/issues/1684\">github issue</a></p>\n<h3 id=\"alias\"><a href=\"#alias\" class=\"headerlink\" title=\"alias\"></a>alias</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">s</span><span class=\"token operator\">=</span><span class=\"token string\">'sudo'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">ls</span><span class=\"token operator\">=</span><span class=\"token string\">'ls --color=auto'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">la</span><span class=\"token operator\">=</span><span class=\"token string\">'ls -a --color=auto'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">ll</span><span class=\"token operator\">=</span><span class=\"token string\">'ls -l --color=auto'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">lla</span><span class=\"token operator\">=</span><span class=\"token string\">'ls -l -a --color=auto'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">pac</span><span class=\"token operator\">=</span><span class=\"token string\">'pacman -S'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">pacyu</span><span class=\"token operator\">=</span><span class=\"token string\">'pacman -Syu'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">spac</span><span class=\"token operator\">=</span><span class=\"token string\">'sudo pacman -S'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">spacyu</span><span class=\"token operator\">=</span><span class=\"token string\">'sudo pacman -Syu'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">v</span><span class=\"token operator\">=</span><span class=\"token string\">'vim'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">sv</span><span class=\"token operator\">=</span><span class=\"token string\">'sudo vim'</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"rsync备份\"><a href=\"#rsync备份\" class=\"headerlink\" title=\"rsync备份\"></a>rsync备份</h3><ul>\n<li>安装rsync<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S <span class=\"token function\">rsync</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li>backup.sh<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> start to backup... type device:'</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">read</span> device <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> type mount dir:'</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">read</span> mount_dir <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> umount $device...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">umount</span> <span class=\"token variable\">$device</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> umount /mnt/$mount_dir...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">umount</span> /mnt/<span class=\"token variable\">$mount_dir</span><span class=\"token punctuation\">;</span> \n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> remove /mnt/$mount_dir...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">rm</span> -rf /mnt/<span class=\"token variable\">$mount_dir</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> create directory /mnt/$mount_dir...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">mkdir</span> /mnt/<span class=\"token variable\">$mount_dir</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> mount $device to /mnt/$mount_dir...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">mount</span> <span class=\"token variable\">$device</span> /mnt/<span class=\"token variable\">$mount_dir</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> create direcotry /mnt/$mount_dir/system_bakcup...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">mkdir</span> /mnt/<span class=\"token variable\">$mount_dir</span>/system_backup<span class=\"token punctuation\">;</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> start to sync files to /mnt/$mount_dir/system_backup...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">rsync</span> --archive --one-file-system --hard-links <span class=\"token punctuation\">\\</span>\n\t--acls --xattrs --sparse <span class=\"token punctuation\">\\</span>\n\t--human-readable --numeric-ids --delete --delete-excluded <span class=\"token punctuation\">\\</span>\n\t--itemize-changes --verbose --progress <span class=\"token punctuation\">\\</span>\n\t--exclude<span class=\"token operator\">=</span><span class=\"token string\">'*~'</span> <span class=\"token punctuation\">\\</span>\n\t--exclude<span class=\"token operator\">=</span><span class=\"token string\">'$device'</span> <span class=\"token punctuation\">\\</span>\n\t--exclude<span class=\"token operator\">=</span><span class=\"token string\">'/mnt'</span> <span class=\"token punctuation\">\\</span>\n\t--exclude<span class=\"token operator\">=</span><span class=\"token string\">'/dev'</span> <span class=\"token punctuation\">\\</span>\n\t--exclude<span class=\"token operator\">=</span><span class=\"token string\">'/var/tmp'</span> <span class=\"token punctuation\">\\</span>\n\t--exclude<span class=\"token operator\">=</span><span class=\"token string\">'/tmp'</span> <span class=\"token punctuation\">\\</span>\n\t/ /mnt/<span class=\"token variable\">$mount_dir</span>/system_backup <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> finished.'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n</ul>\n<h3 id=\"中文及字体设置\"><a href=\"#中文及字体设置\" class=\"headerlink\" title=\"中文及字体设置\"></a>中文及字体设置</h3><ul>\n<li>语言配置<br>去掉<code>/etc/locale.gen</code>中的<code>zh_CN.UTF-8 UTF-8</code>和<code>en_US.UTF-8 UTF-8</code>的注释</li>\n</ul>\n<p>根据需要在<code>~/.xinitrc</code>或者<code>~/.bashrc</code>配置</p>\n<p><strong>在<code>~/.xinitrc</code>中配置要注意在<code>exec xxx</code>之前</strong></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">LANG</span></span><span class=\"token operator\">=</span>zh_CN.UTF-8\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">LANGUAGE</span></span><span class=\"token operator\">=</span>zh_CN:en_US<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<ul>\n<li>字体配置<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S wqy-bitmapfont wqy-microhei noto-fonts noto-fonts-emoji<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n设置<code>~/.config/fontconfig/fonts.conf</code><pre class=\"line-numbers language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\"?></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">fontconfig</span> <span class=\"token name\">SYSTEM</span> <span class=\"token string\">'fonts.dtd'</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fontconfig</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token comment\">&lt;!-- 显示器使用的像素排列方式 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>font<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rgba<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>const</span><span class=\"token punctuation\">></span></span>rgb<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>const</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token comment\">&lt;!-- 字体微调的程度, 可选 hintnone, hintslight (默认), hintmedium, hintfull. --></span>\n  <span class=\"token comment\">&lt;!-- 更高的 hinting 等级可使字体更锐利，同时也会损失更多的细节 --></span>\n  <span class=\"token comment\">&lt;!-- 如果显示器的 DPI 高得不像话 (>=300), 可关闭 hinting, 字体会自然对齐像素 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>font<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hintstyle<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>const</span><span class=\"token punctuation\">></span></span>hintslight<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>const</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token comment\">&lt;!-- 抗锯齿. 除非屏幕DPI奇高否则建议开启 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>font<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>antialias<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bool</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bool</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n\n<span class=\"token comment\">&lt;!-- 全局默认字体　--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&lt;!-- 全局默认英文字体 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">compare</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>contains<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lang<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>en<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&lt;!-- 全局默认中文字体 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">compare</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>contains<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lang<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>zh<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&lt;!-- 默认无衬线字体 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">qual</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>any<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>sans-serif<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>same<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&lt;!-- 默认衬线字体 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">qual</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>any<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>serif<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>same<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&lt;!-- 默认等宽字体 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">qual</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>any<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>monospace<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>same<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token comment\">&lt;!-- 字体替换 --></span>\n  <span class=\"token comment\">&lt;!--SimSun, Microsoft YaHei, SimHei -> WenQuanYi Micro Hei --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>宋体<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>strong<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token comment\">&lt;!-- &lt;string>Noto Serif CJK SC&lt;/string> --></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>SimSun<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>strong<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token comment\">&lt;!-- &lt;string>Noto Serif CJK SC&lt;/string> --></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">qual</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>any<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>SimSun-18030<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>same<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n         <span class=\"token comment\">&lt;!-- &lt;string>Noto Serif CJK SC&lt;/string> --></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">qual</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>any<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Microsoft YaHei<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>same<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">qual</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>any<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>SimHei<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>same<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Times New Roman<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>append<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>strong<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>append<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>strong<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n\n<span class=\"token comment\">&lt;!-- 备用字体优先顺序 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alias</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>sans-serif<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prefer</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Color Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK SC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK TC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK JP<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK KR<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prefer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alias</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alias</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>serif<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prefer</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Color Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK SC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK TC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK JP<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK KR<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prefer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alias</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alias</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>monospace<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prefer</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Color Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK SC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK TC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK JP<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK KR<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prefer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alias</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fontconfig</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n设置字体偏好:<code>/etc/fonts/conf.d/64-language-selector-prefer.conf</code><pre class=\"line-numbers language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\"?></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">fontconfig</span> <span class=\"token name\">SYSTEM</span> <span class=\"token string\">'fonts.dtd'</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fontconfig</span><span class=\"token punctuation\">></span></span>  \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alias</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>sans-serif<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prefer</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Color Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK SC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK TC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK JP<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK KR<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prefer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alias</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alias</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>serif<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prefer</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Color Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK SC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK TC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK JP<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK KR<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prefer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alias</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alias</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>monospace<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prefer</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Color Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK SC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK TC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK JP<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK KR<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prefer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alias</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fontconfig</span><span class=\"token punctuation\">></span></span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n</ul>\n<h3 id=\"安装fcitx5\"><a href=\"#安装fcitx5\" class=\"headerlink\" title=\"安装fcitx5\"></a>安装fcitx5</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S fcitx5-im fcitx5-chinese-addons fcitx5-mozc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"xfce的声音\"><a href=\"#xfce的声音\" class=\"headerlink\" title=\"xfce的声音\"></a>xfce的声音</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S alsa-utils pulseaudio pulseaudio-alsa <span class=\"token punctuation\">\\</span>\n pavucontrol      <span class=\"token comment\">#与xfce4 panel里面的插件配合使用,必须要有这个进程</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>xfce4 panel设置里面添加一个pulseaudio plugin的插件</p>\n<p><code>alsamixer</code> F6选择声卡,然后把mm的M键去掉,上下箭头调节,auto-mute disable了以后,loopback enable. reboot重启,这时候xfce4的插件就可以调节声音了</p>\n<h3 id=\"安装chrome\"><a href=\"#安装chrome\" class=\"headerlink\" title=\"安装chrome\"></a>安装chrome</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\">#AUR 助手</span>\n<span class=\"token function\">git</span> clone https://aur.archlinux.org/yay-git.git\n<span class=\"token builtin class-name\">cd</span> yay-git\nmakepkg -si\n\n<span class=\"token comment\">#yay不要用root</span>\nyay -S google-chrome\n\n<span class=\"token comment\">#升级</span>\nyay -Syu<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"安装clash\"><a href=\"#安装clash\" class=\"headerlink\" title=\"安装clash\"></a>安装clash</h3><p>看<a href=\"https://blog.linioi.com/posts/clash-on-arch/\">这</a><br>或者<a href=\"https://github.com/Fndroid/clash_for_windows_pkg/releases\">class for windows</a></p>\n<h3 id=\"支持ntfs\"><a href=\"#支持ntfs\" class=\"headerlink\" title=\"支持ntfs\"></a>支持ntfs</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S ntfs-3g<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<blockquote>\n<p><a href=\"https://wiki.archlinux.org/\">https://wiki.archlinux.org/</a></p>\n</blockquote>\n<h2 id=\"基本系统安装\"><a href=\"#基本系统安装\" class=\"headerlink\" title=\"基本系统安装\"></a>基本系统安装</h2><h3 id=\"前置准备\"><a href=\"#前置准备\" class=\"headerlink\" title=\"前置准备\"></a>前置准备</h3><ul>\n<li>检查网络<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">ip</span> <span class=\"token function\">link</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li>更新系统时间<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">timedatectl set-ntp <span class=\"token boolean\">true</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"准备磁盘\"><a href=\"#准备磁盘\" class=\"headerlink\" title=\"准备磁盘\"></a>准备磁盘</h3></li>\n<li>分区<ul>\n<li><p>查看当前磁盘信息</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">fdisk</span> -l<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li><p>进入分区</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">fdisk</span> /dev/the_disk_to_be_partitioned（要被分区的磁盘）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>uefi参考：</p>\n<div class=\"table-wrapper\"/>\n<table>\n<thead>\n<tr>\n<th>挂载点</th>\n<th>分区</th>\n<th>分区类型</th>\n<th>大小</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>&#x2F;mnt&#x2F;boot&#x2F;EFI</td>\n<td>&#x2F;dev&#x2F;efi_system_partition</td>\n<td>EFI系统分区</td>\n<td>300M</td>\n</tr>\n<tr>\n<td>[swap] <strong>移动设备建议不要</strong></td>\n<td>&#x2F;dev&#x2F;swap_partition&#x2F;</td>\n<td>Linux swap (交换空间)</td>\n<td>&gt; 512M (2G if physical ram &gt; 4G)</td>\n</tr>\n<tr>\n<td>&#x2F;mnt</td>\n<td>&#x2F;dev&#x2F;root_partition</td>\n<td>Linux x86-64 根目录 (&#x2F;)</td>\n<td>剩余空间</td>\n</tr>\n</tbody></table>\n</div>\n</li>\n<li><p><em>移动设备的情况下:</em></p>\n<div class=\"table-wrapper\"/>\n<table>\n<thead>\n<tr>\n<th>挂载点</th>\n<th>分区</th>\n<th>分区类型</th>\n<th>大小</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><em>none</em></td>\n<td><em>none</em></td>\n<td>BIOS启动分区</td>\n<td>1M</td>\n</tr>\n<tr>\n<td>&#x2F;mnt&#x2F;boot&#x2F;EFI</td>\n<td>&#x2F;dev&#x2F;efi_system_partition</td>\n<td>EFI系统分区</td>\n<td>300M</td>\n</tr>\n<tr>\n<td>&#x2F;mnt</td>\n<td>&#x2F;dev&#x2F;root_partition</td>\n<td>Linux x86-64 根目录 (&#x2F;)</td>\n<td>剩余空间</td>\n</tr>\n</tbody></table>\n</div>\n</li>\n<li><p>格式化分区</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mkfs.ext4 /dev/root_partition（根分区）\n<span class=\"token comment\"># 移动设备关闭日志 mkfs.ext4 -O \"^has_journal\" /dev/root_partition（根分区）</span>\n<span class=\"token function\">mkswap</span> /dev/swap_partition（交换空间分区）\nmkfs.fat -F <span class=\"token number\">32</span> /dev/efi_system_partition<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre></li>\n<li><p>挂载分区&amp;启用交换空间</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">mount</span> /dev/root_partition（根分区） /mnt\n<span class=\"token function\">mount</span> /dev/efi_system_partition /mnt/boot/efi\n<span class=\"token function\">swapon</span> /dev/swap_partition（交换空间分区）<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre></li>\n</ul>\n</li>\n</ul>\n<h3 id=\"安装系统\"><a href=\"#安装系统\" class=\"headerlink\" title=\"安装系统\"></a>安装系统</h3><ul>\n<li><p>设置cn源</p>\n<p>第一种方法</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token function\">curl</span> <span class=\"token string\">'https://archlinux.org/mirrorlist/?country=CN&amp;prototcol=http&amp;protocol=https&amp;ip_version=4'</span> <span class=\"token operator\">></span> /etc/pacman.d/mirrorlist <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token builtin class-name\">echo</span> /etc/pacman.d/mirrorlist <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token function\">sudo</span> <span class=\"token function\">vim</span> /etc/pacman.d/mirrorlist <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'pacman mirror list updated'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>  然后将<code>/etc/pacman.d/mirrorlist</code>中注释去掉</p>\n<p>第二种方法</p>\n<p>在<code>/etc/pacman.d/mirrorlist</code>中搜索CN，放到最前面，推荐aliyun的源</p>\n</li>\n<li><p>安装系统&amp;软件包</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pacstrap /mnt base base-devel linux linux-firmware <span class=\"token function\">vim</span> <span class=\"token function\">vi</span> <span class=\"token function\">sudo</span> <span class=\"token function\">git</span>\n<span class=\"token comment\"># 移动设备 可以使用基于BFQ的io调度内核linux-zen，把linux换成linux-zen</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre></li>\n</ul>\n<p>  <em>参考：<a href=\"https://www.kernel.org/doc/html/latest/block/bfq-iosched.html\">BFQ</a></em></p>\n<h2 id=\"系统配置\"><a href=\"#系统配置\" class=\"headerlink\" title=\"系统配置\"></a>系统配置</h2><h3 id=\"系统引导\"><a href=\"#系统引导\" class=\"headerlink\" title=\"系统引导\"></a>系统引导</h3><ul>\n<li>配置fstab  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">genfstab -U /mnt <span class=\"token operator\">>></span> /mnt/etc/fstab<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li>安装grub  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pacman -S efibootmgr grub\n\n<span class=\"token comment\"># uefi</span>\ngrub-install --target<span class=\"token operator\">=</span>x86_64-efi --efi-directory<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>挂载点,如/mnt/boot/EFI<span class=\"token punctuation\">&#125;</span> --bootloader-id<span class=\"token operator\">=</span>GRUB\n\n<span class=\"token comment\"># bios(非GPT分区无需其他空间，但GPT分区需要有一块1M的BIOS boot分区)</span>\ngrub-install --target<span class=\"token operator\">=</span>i386-pc /dev/sdX<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n</ul>\n<p>  <em>移动设备的情况下</em></p>\n<p>  假设分区顺序是：<br>    - BIOS<br>    - EFI<br>    - root<br>  要先在这块设备上写入引导信息，运行<code>gdisk /dev/sdX</code></p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># gdisk /dev/sdX</span>\n\nCommand <span class=\"token punctuation\">(</span>? <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>: r\nRecovery/transformation <span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">(</span>? <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>: h\n\nWARNING<span class=\"token operator\">!</span> Hybrid MBRs are flaky and dangerous<span class=\"token operator\">!</span> If you decide not to use one,\njust hit the Enter key at the below prompt and your MBR partition table will\nbe untouched.\n\nType from one to three GPT partition numbers, separated by spaces, to be added to the hybrid MBR, <span class=\"token keyword\">in</span> sequence: <span class=\"token number\">1</span> <span class=\"token number\">2</span> <span class=\"token number\">3</span>\nPlace EFI GPT <span class=\"token punctuation\">(</span>0xEE<span class=\"token punctuation\">)</span> partition first <span class=\"token keyword\">in</span> MBR <span class=\"token punctuation\">(</span>good <span class=\"token keyword\">for</span> GRUB<span class=\"token punctuation\">)</span>? <span class=\"token punctuation\">(</span>Y/N<span class=\"token punctuation\">)</span>: N\n\nCreating entry <span class=\"token keyword\">for</span> GPT partition <span class=\"token comment\">#1 (MBR partition #1)</span>\nEnter an MBR hex code <span class=\"token punctuation\">(</span>default EF<span class=\"token punctuation\">)</span>: \nSet the bootable flag? <span class=\"token punctuation\">(</span>Y/N<span class=\"token punctuation\">)</span>: N\n\nCreating entry <span class=\"token keyword\">for</span> GPT partition <span class=\"token comment\">#2 (MBR partition #2)</span>\nEnter an MBR hex code <span class=\"token punctuation\">(</span>default EF<span class=\"token punctuation\">)</span>: \nSet the bootable flag? <span class=\"token punctuation\">(</span>Y/N<span class=\"token punctuation\">)</span>: N\n\nCreating entry <span class=\"token keyword\">for</span> GPT partition <span class=\"token comment\">#3 (MBR partition #3)</span>\nEnter an MBR hex code <span class=\"token punctuation\">(</span>default <span class=\"token number\">83</span><span class=\"token punctuation\">)</span>: \nSet the bootable flag? <span class=\"token punctuation\">(</span>Y/N<span class=\"token punctuation\">)</span>: Y\n\nRecovery/transformation <span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">(</span>? <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>: x\nExpert <span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">(</span>? <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>: h\nExpert <span class=\"token builtin class-name\">command</span> <span class=\"token punctuation\">(</span>? <span class=\"token keyword\">for</span> <span class=\"token builtin class-name\">help</span><span class=\"token punctuation\">)</span>: w\n\nFinal checks complete. About to <span class=\"token function\">write</span> GPT data. THIS WILL OVERWRITE EXISTING\nPARTITIONS<span class=\"token operator\">!</span><span class=\"token operator\">!</span>\n\nDo you want to proceed? <span class=\"token punctuation\">(</span>Y/N<span class=\"token punctuation\">)</span>: Y<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<blockquote>\n<p><strong>如果不需要兼容，不用做这一步，混合分区会在设备上存在两个分区表，系统识别这个设备分区的时候具体的行为完全依赖于系统的实现，非常不稳定</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>注意：写完hybrid之后，默认的windows中就只认MBR分区，假设分区按上面的例子，且还有一个4号分区，那么由于MBR的限制</strong><br><strong>在windows中第四个分区是无法正确识别文件系统的，如果要使用第四个分区且要通过MBR引导，那么这里就要在MBR写入134分区</strong><br><strong>ESP分区可以不用写到MBR里</strong></p>\n</blockquote>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pacman -S efibootmgr grub amd-ucode intel-ucode\n\n<span class=\"token comment\"># uefi + MBR(BIOS)混合启动</span>\ngrub-install --target<span class=\"token operator\">=</span>x86_64-efi --efi-directory<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>挂载点,如/mnt/boot/EFI<span class=\"token punctuation\">&#125;</span> --removable\n --bootloader-id<span class=\"token operator\">=</span>GRUB --boot-directory<span class=\"token operator\">=</span><span class=\"token punctuation\">&#123;</span>root挂载点,如/mnt<span class=\"token punctuation\">&#125;</span>/boot\n\ngrub-install --target<span class=\"token operator\">=</span>i386-pc --recheck --boot-directory<span class=\"token operator\">=</span>/DATA_MOUNTPOINT/boot /dev/sdX <span class=\"token comment\">#注意这里是整个设备</span>\n\n<span class=\"token comment\"># 作为保险</span>\ngrub-install --target<span class=\"token operator\">=</span>i386-pc --recheck --boot-directory<span class=\"token operator\">=</span>/DATA_MOUNTPOINT/boot /dev/<span class=\"token punctuation\">&#123;</span>root的那个分区<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<ul>\n<li><p>切换到已经安装的系统</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">arch-chroot /mnt<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li><p>配置grub.cfg</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">grub-mkconfig</span> -o /boot/grub/grub.cfg<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<h3 id=\"系统初始化设置\"><a href=\"#系统初始化设置\" class=\"headerlink\" title=\"系统初始化设置\"></a>系统初始化设置</h3></li>\n<li><p>设置时区</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\nhwclock --systohc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre></li>\n<li><p>本地化</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">locale-gen<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n</ul>\n<p>  – 移动设备最小化磁盘访问,把日志放到内存<br>  修改<code>/etc/systemd/journald.conf.d/usbstick.conf</code><br>  写入<br>  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token punctuation\">[</span>Journal<span class=\"token punctuation\">]</span>\n<span class=\"token assign-left variable\">Storage</span><span class=\"token operator\">=</span>volatile\n<span class=\"token assign-left variable\">RuntimeMaxUse</span><span class=\"token operator\">=</span>30M<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre></p>\n<ul>\n<li>initramfs<br>  如果是移动设备，将<code>/etc/mkinitcpio.conf</code>中<code>HOOKS</code>里面的<code>block</code>和<code>keyboard</code>放到<code>autodetect</code>前面，然后  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">mkinitcpio -P<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n</ul>\n<p>  创建<code>/etc/locale.conf</code>,设置<code>LANG=en_US.UTF-8</code></p>\n<ul>\n<li><p>hostname<br>  创建<code>/etc/hostname</code>,写入主机名</p>\n</li>\n<li><p>root密码</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">passwd</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li><p>hosts<br>  向<code>/etc/hosts</code>写入</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token number\">127.0</span>.0.1 localhost\n::1 localhost\n<span class=\"token number\">127.0</span>.0.1 <span class=\"token punctuation\">&#123;</span>hostname<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>安装网络工具</p>\n</li>\n</ul>\n<p>  *networkmanager已经不使用dhcpcd, 因此需要安装dhclient<br>  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">pacman -S iw wpa_supplicant dialog dhcpcd dhclient netctl networkmanager network-manager-applet gnome-keyring\n<span class=\"token comment\"># 设置网络开机启动</span>\nsystemctl <span class=\"token builtin class-name\">enable</span> NetworkManager.service<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre></p>\n<ul>\n<li>新增用户  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">useradd</span> -m -G users,audio,lp,optical,storage,video,wheel,power -s /bin/bash 普通用户名\n<span class=\"token function\">passwd</span> 普通用户名<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n  运行<code>visudo</code>, 去掉<code>%wheel ALL=(ALL) ALL</code>注释</li>\n</ul>\n<p><strong>到这里基本已经完成最小系统的配置和安装，在继续之前，改启动项然后reboot</strong></p>\n<h2 id=\"DE-x2F-WM-x2F-DM\"><a href=\"#DE-x2F-WM-x2F-DM\" class=\"headerlink\" title=\"DE&#x2F;WM&#x2F;DM\"></a>DE&#x2F;WM&#x2F;DM</h2><ul>\n<li><p>安装xorg</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S xorg xorg-xinit\n<span class=\"token comment\">## 移动设备要安装</span>\n<span class=\"token comment\"># xf86-input-synaptics 支持触控板</span>\n<span class=\"token comment\"># xf86-video-vesa, xf86-video-ati, xf86-video-intel, xf86-video-amdgpu, xf86-video-nouveau and xf86-video-fbdev. 大多数的开源显卡驱动</span>\n<span class=\"token comment\">#  libeatmydata  可以禁用fsync，比如对于firefox：eatmydata firefox</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n<li><p>安装字体</p>\n  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S terminus-font <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li><p>安装DE</p>\n<ul>\n<li>Mate<ul>\n<li>安装mate<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S mate mate-extra<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li>配置xinitrc<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">cp</span> /etc/X11/xinit/xinitrc ~/.xinitrc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n把最后的启动换成<code>exec mate-session</code></li>\n</ul>\n</li>\n<li>XFCE<ul>\n<li>安装xfce<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S xfce4 xfce4-goodies<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li>配置xinitrc<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">cp</span> /etc/X11/xinit/xinitrc ~/.xinitrc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n把最后的启动换成<code>exec startxfce4</code></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>仅安装WM</p>\n<p><em>(略)</em></p>\n</li>\n<li><p>安装DM</p>\n<ul>\n<li>lightdm<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S lightdm-gtk-greeter<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h2><h3 id=\"支持hyper-v增强模式\"><a href=\"#支持hyper-v增强模式\" class=\"headerlink\" title=\"支持hyper-v增强模式\"></a>支持hyper-v增强模式</h3>  <pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">git</span> clone https://www.github.com/Microsoft/linux-vm-tools\n<span class=\"token builtin class-name\">cd</span> linux-vm-tools/arch\n<span class=\"token comment\"># 要先开代理</span>\n./make<span class=\"token punctuation\">..</span>.\n./install<span class=\"token punctuation\">..</span>.<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>然后记得在win中用管理员设置</p>\n<pre class=\"line-numbers language-cmd\" data-language=\"cmd\"><code class=\"language-cmd\">Set-VM -VMName &lt;your_vm_name&gt;  -EnhancedSessionTransportType HvSocket<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<p>  <strong>如果无法通过增强模式连接</strong></p>\n<p>  <a href=\"https://wiki.archlinux.org/title/Xrdp#loginctl_or_systemctl_--user_not_working\">arch wiki [loginctl or systemctl –user not working]</a></p>\n<p>  Try commenting out all the references to <code>systemd-home</code> in <code>/etc/pam.d/system-auth</code>, see <a href=\"https://github.com/neutrinolabs/xrdp/issues/1684\">github issue</a></p>\n<h3 id=\"alias\"><a href=\"#alias\" class=\"headerlink\" title=\"alias\"></a>alias</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">s</span><span class=\"token operator\">=</span><span class=\"token string\">'sudo'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">ls</span><span class=\"token operator\">=</span><span class=\"token string\">'ls --color=auto'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">la</span><span class=\"token operator\">=</span><span class=\"token string\">'ls -a --color=auto'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">ll</span><span class=\"token operator\">=</span><span class=\"token string\">'ls -l --color=auto'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">lla</span><span class=\"token operator\">=</span><span class=\"token string\">'ls -l -a --color=auto'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">pac</span><span class=\"token operator\">=</span><span class=\"token string\">'pacman -S'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">pacyu</span><span class=\"token operator\">=</span><span class=\"token string\">'pacman -Syu'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">spac</span><span class=\"token operator\">=</span><span class=\"token string\">'sudo pacman -S'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">spacyu</span><span class=\"token operator\">=</span><span class=\"token string\">'sudo pacman -Syu'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">v</span><span class=\"token operator\">=</span><span class=\"token string\">'vim'</span>\n<span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">sv</span><span class=\"token operator\">=</span><span class=\"token string\">'sudo vim'</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<h3 id=\"rsync备份\"><a href=\"#rsync备份\" class=\"headerlink\" title=\"rsync备份\"></a>rsync备份</h3><ul>\n<li>安装rsync<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S <span class=\"token function\">rsync</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre></li>\n<li>backup.sh<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> start to backup... type device:'</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">read</span> device <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> type mount dir:'</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">read</span> mount_dir <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> umount $device...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">umount</span> <span class=\"token variable\">$device</span><span class=\"token punctuation\">;</span><span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> umount /mnt/$mount_dir...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">umount</span> /mnt/<span class=\"token variable\">$mount_dir</span><span class=\"token punctuation\">;</span> \n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> remove /mnt/$mount_dir...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">rm</span> -rf /mnt/<span class=\"token variable\">$mount_dir</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> create directory /mnt/$mount_dir...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">mkdir</span> /mnt/<span class=\"token variable\">$mount_dir</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> mount $device to /mnt/$mount_dir...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">mount</span> <span class=\"token variable\">$device</span> /mnt/<span class=\"token variable\">$mount_dir</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> create direcotry /mnt/$mount_dir/system_bakcup...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">mkdir</span> /mnt/<span class=\"token variable\">$mount_dir</span>/system_backup<span class=\"token punctuation\">;</span>\n\t<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> start to sync files to /mnt/$mount_dir/system_backup...'</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">\\</span>\n\t<span class=\"token function\">rsync</span> --archive --one-file-system --hard-links <span class=\"token punctuation\">\\</span>\n\t--acls --xattrs --sparse <span class=\"token punctuation\">\\</span>\n\t--human-readable --numeric-ids --delete --delete-excluded <span class=\"token punctuation\">\\</span>\n\t--itemize-changes --verbose --progress <span class=\"token punctuation\">\\</span>\n\t--exclude<span class=\"token operator\">=</span><span class=\"token string\">'*~'</span> <span class=\"token punctuation\">\\</span>\n\t--exclude<span class=\"token operator\">=</span><span class=\"token string\">'$device'</span> <span class=\"token punctuation\">\\</span>\n\t--exclude<span class=\"token operator\">=</span><span class=\"token string\">'/mnt'</span> <span class=\"token punctuation\">\\</span>\n\t--exclude<span class=\"token operator\">=</span><span class=\"token string\">'/dev'</span> <span class=\"token punctuation\">\\</span>\n\t--exclude<span class=\"token operator\">=</span><span class=\"token string\">'/var/tmp'</span> <span class=\"token punctuation\">\\</span>\n\t--exclude<span class=\"token operator\">=</span><span class=\"token string\">'/tmp'</span> <span class=\"token punctuation\">\\</span>\n\t/ /mnt/<span class=\"token variable\">$mount_dir</span>/system_backup <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'==> finished.'</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n</ul>\n<h3 id=\"中文及字体设置\"><a href=\"#中文及字体设置\" class=\"headerlink\" title=\"中文及字体设置\"></a>中文及字体设置</h3><ul>\n<li>语言配置<br>去掉<code>/etc/locale.gen</code>中的<code>zh_CN.UTF-8 UTF-8</code>和<code>en_US.UTF-8 UTF-8</code>的注释</li>\n</ul>\n<p>根据需要在<code>~/.xinitrc</code>或者<code>~/.bashrc</code>配置</p>\n<p><strong>在<code>~/.xinitrc</code>中配置要注意在<code>exec xxx</code>之前</strong></p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">LANG</span></span><span class=\"token operator\">=</span>zh_CN.UTF-8\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">LANGUAGE</span></span><span class=\"token operator\">=</span>zh_CN:en_US<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<ul>\n<li>字体配置<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S wqy-bitmapfont wqy-microhei noto-fonts noto-fonts-emoji<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n设置<code>~/.config/fontconfig/fonts.conf</code><pre class=\"line-numbers language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\"?></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">fontconfig</span> <span class=\"token name\">SYSTEM</span> <span class=\"token string\">'fonts.dtd'</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fontconfig</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token comment\">&lt;!-- 显示器使用的像素排列方式 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>font<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>rgba<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>const</span><span class=\"token punctuation\">></span></span>rgb<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>const</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token comment\">&lt;!-- 字体微调的程度, 可选 hintnone, hintslight (默认), hintmedium, hintfull. --></span>\n  <span class=\"token comment\">&lt;!-- 更高的 hinting 等级可使字体更锐利，同时也会损失更多的细节 --></span>\n  <span class=\"token comment\">&lt;!-- 如果显示器的 DPI 高得不像话 (>=300), 可关闭 hinting, 字体会自然对齐像素 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>font<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>hintstyle<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>const</span><span class=\"token punctuation\">></span></span>hintslight<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>const</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token comment\">&lt;!-- 抗锯齿. 除非屏幕DPI奇高否则建议开启 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>font<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>antialias<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>bool</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>bool</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n\n<span class=\"token comment\">&lt;!-- 全局默认字体　--></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&lt;!-- 全局默认英文字体 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">compare</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>contains<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lang<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>en<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&lt;!-- 全局默认中文字体 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">compare</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>contains<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>lang<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>zh<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&lt;!-- 默认无衬线字体 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">qual</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>any<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>sans-serif<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>same<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&lt;!-- 默认衬线字体 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">qual</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>any<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>serif<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>same<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token comment\">&lt;!-- 默认等宽字体 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">qual</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>any<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>monospace<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>prepend<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>same<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token comment\">&lt;!-- 字体替换 --></span>\n  <span class=\"token comment\">&lt;!--SimSun, Microsoft YaHei, SimHei -> WenQuanYi Micro Hei --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>宋体<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>strong<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token comment\">&lt;!-- &lt;string>Noto Serif CJK SC&lt;/string> --></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>SimSun<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>strong<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token comment\">&lt;!-- &lt;string>Noto Serif CJK SC&lt;/string> --></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">qual</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>any<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>SimSun-18030<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>same<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n         <span class=\"token comment\">&lt;!-- &lt;string>Noto Serif CJK SC&lt;/string> --></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">qual</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>any<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Microsoft YaHei<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>same<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">qual</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>any<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>SimHei<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>assign<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>same<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Times New Roman<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>append<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>strong<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>match</span> <span class=\"token attr-name\">target</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>pattern<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>test</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>test</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>edit</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>family<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">mode</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>append<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">binding</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>strong<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>string</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>edit</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>match</span><span class=\"token punctuation\">></span></span>\n\n\n<span class=\"token comment\">&lt;!-- 备用字体优先顺序 --></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alias</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>sans-serif<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prefer</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Color Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK SC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK TC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK JP<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK KR<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prefer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alias</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alias</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>serif<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prefer</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Color Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK SC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK TC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK JP<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK KR<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prefer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alias</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alias</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>monospace<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prefer</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Color Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK SC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK TC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK JP<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK KR<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prefer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alias</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fontconfig</span><span class=\"token punctuation\">></span></span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n设置字体偏好:<code>/etc/fonts/conf.d/64-language-selector-prefer.conf</code><pre class=\"line-numbers language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token prolog\">&lt;?xml version=\"1.0\"?></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">fontconfig</span> <span class=\"token name\">SYSTEM</span> <span class=\"token string\">'fonts.dtd'</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>fontconfig</span><span class=\"token punctuation\">></span></span>  \n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alias</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>sans-serif<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prefer</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Color Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK SC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK TC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK JP<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK KR<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prefer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alias</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alias</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>serif<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prefer</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Color Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK SC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK TC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK JP<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK KR<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prefer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alias</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>alias</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>monospace<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>prefer</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Terminus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>WenQuanYi WenQuanYi Bitmap Song<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Color Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Emoji<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK SC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK TC<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK JP<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>family</span><span class=\"token punctuation\">></span></span>Noto Sans CJK KR<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>family</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>prefer</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>alias</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>fontconfig</span><span class=\"token punctuation\">></span></span>\n\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>\n</ul>\n<h3 id=\"安装fcitx5\"><a href=\"#安装fcitx5\" class=\"headerlink\" title=\"安装fcitx5\"></a>安装fcitx5</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S fcitx5-im fcitx5-chinese-addons fcitx5-mozc<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n\n<h3 id=\"xfce的声音\"><a href=\"#xfce的声音\" class=\"headerlink\" title=\"xfce的声音\"></a>xfce的声音</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S alsa-utils pulseaudio pulseaudio-alsa <span class=\"token punctuation\">\\</span>\n pavucontrol      <span class=\"token comment\">#与xfce4 panel里面的插件配合使用,必须要有这个进程</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>xfce4 panel设置里面添加一个pulseaudio plugin的插件</p>\n<p><code>alsamixer</code> F6选择声卡,然后把mm的M键去掉,上下箭头调节,auto-mute disable了以后,loopback enable. reboot重启,这时候xfce4的插件就可以调节声音了</p>\n<h3 id=\"安装chrome\"><a href=\"#安装chrome\" class=\"headerlink\" title=\"安装chrome\"></a>安装chrome</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\">#AUR 助手</span>\n<span class=\"token function\">git</span> clone https://aur.archlinux.org/yay-git.git\n<span class=\"token builtin class-name\">cd</span> yay-git\nmakepkg -si\n\n<span class=\"token comment\">#yay不要用root</span>\nyay -S google-chrome\n\n<span class=\"token comment\">#升级</span>\nyay -Syu<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"安装clash\"><a href=\"#安装clash\" class=\"headerlink\" title=\"安装clash\"></a>安装clash</h3><p>看<a href=\"https://blog.linioi.com/posts/clash-on-arch/\">这</a><br>或者<a href=\"https://github.com/Fndroid/clash_for_windows_pkg/releases\">class for windows</a></p>\n<h3 id=\"支持ntfs\"><a href=\"#支持ntfs\" class=\"headerlink\" title=\"支持ntfs\"></a>支持ntfs</h3><pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S ntfs-3g<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>"},{"title":"Frida-il2cpp-bridge script for fate/go","date":"2022-03-17T07:10:42.000Z","_content":"\nhack script for fgo based on [frida](https://github.com/frida/frida) and [frida-il2cpp-bridge](https://github.com/vfsfitvnm/frida-il2cpp-bridge) \n\n### Supports\n\n- bilibili fate go v2.36.0\n\n- aniplex fate go v2.49.0\n  \n  *fate go in other channels/platforms/versions may functional but it's not tested*\n\n### Steps\n\n#### For Android\n\n**Android 10 or 11 is recommended, among testing in android 9 sometimes game may crash*\n\n- Install nodeJs for NPM\n\n- Install frida and frida-tools with ` npm install frida && npm install frida-tools`\n\n- Download latest frida-server from https://github.com/frida/frida/releases\n\n- Start rooted device, rettach with ` adb root`\n\n- Install game apk\n\n- Copy ***frida-server*** file to device directory such as ***/data/local/tmp***\n\n- Run `adb shell` to connect to device\n\n- Change ***frida-server*** file permission with `chmod 777 {directory}/frida-server`\n\n- Navigate to directory and run server with `./frida-server`\n\n#### For IOS\n\n- TODO\n\n#### Run script\n\n- See comments in ***fgo_hack_script.ts***, and change codes according to the *fgo* version\n  \n  - there is some tiny diffrences between *bili fatego* and *aniplex fatego*\n\n- Build with `./build_aniplex.sh` or `./build_bili.sh`\n\n- Run with `./run.sh com.bilibili.fgo` or `./run.sh com.aniplex.fategrandorder`\n  \n  - you could now see some logs (if codes like `console.log(...)` is uncommented) when starting battle\n\n- Have fun.\n\n### Features\n\n![in battle](/images/0.jpg)\n\n#### active\n\n1. Increase player's servant hp (by 500,000)\n\n2. Set all skills lv to 10 (both servant's and master's)\n\n3. Change all skills charge turn down (to 1)\n\n4. Try to disable codestage anti-cheat engine (notice that there is **NO WAY** to cheat safely cause anyway the battle data will be sent to game server)\n\n#### inactive\n\n1. Never die (reset hp every time servant dies)\n\n2. Increase attack & defence np rate\n\n3. Increase attack star rate\n\n### Issues\n\n- Could not ran with X64-based simulator such as MuMu (tested) at this time ([frida-il2cpp-bridge](https://github.com/vfsfitvnm/frida-il2cpp-bridge) version 0.7.9)\n\n- Features in [inactive](#inactive) may invoked too frequently that may cause some leakage\n","source":"_posts/fgo-frida-il2cpp-bridge.md","raw":"---\ntitle: Frida-il2cpp-bridge script for fate/go\ndate: 2022-03-17 15:10:42\ncategories: \n\t- hack\ntags:\n  - wallhack\n  - injection\n  - reverse engineering\n  - fgo\n---\n\nhack script for fgo based on [frida](https://github.com/frida/frida) and [frida-il2cpp-bridge](https://github.com/vfsfitvnm/frida-il2cpp-bridge) \n\n### Supports\n\n- bilibili fate go v2.36.0\n\n- aniplex fate go v2.49.0\n  \n  *fate go in other channels/platforms/versions may functional but it's not tested*\n\n### Steps\n\n#### For Android\n\n**Android 10 or 11 is recommended, among testing in android 9 sometimes game may crash*\n\n- Install nodeJs for NPM\n\n- Install frida and frida-tools with ` npm install frida && npm install frida-tools`\n\n- Download latest frida-server from https://github.com/frida/frida/releases\n\n- Start rooted device, rettach with ` adb root`\n\n- Install game apk\n\n- Copy ***frida-server*** file to device directory such as ***/data/local/tmp***\n\n- Run `adb shell` to connect to device\n\n- Change ***frida-server*** file permission with `chmod 777 {directory}/frida-server`\n\n- Navigate to directory and run server with `./frida-server`\n\n#### For IOS\n\n- TODO\n\n#### Run script\n\n- See comments in ***fgo_hack_script.ts***, and change codes according to the *fgo* version\n  \n  - there is some tiny diffrences between *bili fatego* and *aniplex fatego*\n\n- Build with `./build_aniplex.sh` or `./build_bili.sh`\n\n- Run with `./run.sh com.bilibili.fgo` or `./run.sh com.aniplex.fategrandorder`\n  \n  - you could now see some logs (if codes like `console.log(...)` is uncommented) when starting battle\n\n- Have fun.\n\n### Features\n\n![in battle](/images/0.jpg)\n\n#### active\n\n1. Increase player's servant hp (by 500,000)\n\n2. Set all skills lv to 10 (both servant's and master's)\n\n3. Change all skills charge turn down (to 1)\n\n4. Try to disable codestage anti-cheat engine (notice that there is **NO WAY** to cheat safely cause anyway the battle data will be sent to game server)\n\n#### inactive\n\n1. Never die (reset hp every time servant dies)\n\n2. Increase attack & defence np rate\n\n3. Increase attack star rate\n\n### Issues\n\n- Could not ran with X64-based simulator such as MuMu (tested) at this time ([frida-il2cpp-bridge](https://github.com/vfsfitvnm/frida-il2cpp-bridge) version 0.7.9)\n\n- Features in [inactive](#inactive) may invoked too frequently that may cause some leakage\n","slug":"fgo-frida-il2cpp-bridge","published":1,"updated":"2022-06-13T15:23:46.980Z","_id":"cl4cuks3u0003doou1szpazpk","comments":1,"layout":"post","photos":[],"link":"","content":"<p>hack script for fgo based on <a href=\"https://github.com/frida/frida\">frida</a> and <a href=\"https://github.com/vfsfitvnm/frida-il2cpp-bridge\">frida-il2cpp-bridge</a> </p>\n<h3 id=\"Supports\"><a href=\"#Supports\" class=\"headerlink\" title=\"Supports\"></a>Supports</h3><ul>\n<li><p>bilibili fate go v2.36.0</p>\n</li>\n<li><p>aniplex fate go v2.49.0</p>\n<p><em>fate go in other channels&#x2F;platforms&#x2F;versions may functional but it’s not tested</em></p>\n</li>\n</ul>\n<h3 id=\"Steps\"><a href=\"#Steps\" class=\"headerlink\" title=\"Steps\"></a>Steps</h3><h4 id=\"For-Android\"><a href=\"#For-Android\" class=\"headerlink\" title=\"For Android\"></a>For Android</h4><p>*<em>Android 10 or 11 is recommended, among testing in android 9 sometimes game may crash</em></p>\n<ul>\n<li><p>Install nodeJs for NPM</p>\n</li>\n<li><p>Install frida and frida-tools with <code> npm install frida &amp;&amp; npm install frida-tools</code></p>\n</li>\n<li><p>Download latest frida-server from <a href=\"https://github.com/frida/frida/releases\">https://github.com/frida/frida/releases</a></p>\n</li>\n<li><p>Start rooted device, rettach with <code> adb root</code></p>\n</li>\n<li><p>Install game apk</p>\n</li>\n<li><p>Copy <em><strong>frida-server</strong></em> file to device directory such as <em><strong>&#x2F;data&#x2F;local&#x2F;tmp</strong></em></p>\n</li>\n<li><p>Run <code>adb shell</code> to connect to device</p>\n</li>\n<li><p>Change <em><strong>frida-server</strong></em> file permission with <code>chmod 777 &#123;directory&#125;/frida-server</code></p>\n</li>\n<li><p>Navigate to directory and run server with <code>./frida-server</code></p>\n</li>\n</ul>\n<h4 id=\"For-IOS\"><a href=\"#For-IOS\" class=\"headerlink\" title=\"For IOS\"></a>For IOS</h4><ul>\n<li>TODO</li>\n</ul>\n<h4 id=\"Run-script\"><a href=\"#Run-script\" class=\"headerlink\" title=\"Run script\"></a>Run script</h4><ul>\n<li><p>See comments in <em><strong>fgo_hack_script.ts</strong></em>, and change codes according to the <em>fgo</em> version</p>\n<ul>\n<li>there is some tiny diffrences between <em>bili fatego</em> and <em>aniplex fatego</em></li>\n</ul>\n</li>\n<li><p>Build with <code>./build_aniplex.sh</code> or <code>./build_bili.sh</code></p>\n</li>\n<li><p>Run with <code>./run.sh com.bilibili.fgo</code> or <code>./run.sh com.aniplex.fategrandorder</code></p>\n<ul>\n<li>you could now see some logs (if codes like <code>console.log(...)</code> is uncommented) when starting battle</li>\n</ul>\n</li>\n<li><p>Have fun.</p>\n</li>\n</ul>\n<h3 id=\"Features\"><a href=\"#Features\" class=\"headerlink\" title=\"Features\"></a>Features</h3><p><img src=\"/images/0.jpg\" alt=\"in battle\"></p>\n<h4 id=\"active\"><a href=\"#active\" class=\"headerlink\" title=\"active\"></a>active</h4><ol>\n<li><p>Increase player’s servant hp (by 500,000)</p>\n</li>\n<li><p>Set all skills lv to 10 (both servant’s and master’s)</p>\n</li>\n<li><p>Change all skills charge turn down (to 1)</p>\n</li>\n<li><p>Try to disable codestage anti-cheat engine (notice that there is <strong>NO WAY</strong> to cheat safely cause anyway the battle data will be sent to game server)</p>\n</li>\n</ol>\n<h4 id=\"inactive\"><a href=\"#inactive\" class=\"headerlink\" title=\"inactive\"></a>inactive</h4><ol>\n<li><p>Never die (reset hp every time servant dies)</p>\n</li>\n<li><p>Increase attack &amp; defence np rate</p>\n</li>\n<li><p>Increase attack star rate</p>\n</li>\n</ol>\n<h3 id=\"Issues\"><a href=\"#Issues\" class=\"headerlink\" title=\"Issues\"></a>Issues</h3><ul>\n<li><p>Could not ran with X64-based simulator such as MuMu (tested) at this time (<a href=\"https://github.com/vfsfitvnm/frida-il2cpp-bridge\">frida-il2cpp-bridge</a> version 0.7.9)</p>\n</li>\n<li><p>Features in <a href=\"#inactive\">inactive</a> may invoked too frequently that may cause some leakage</p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>hack script for fgo based on <a href=\"https://github.com/frida/frida\">frida</a> and <a href=\"https://github.com/vfsfitvnm/frida-il2cpp-bridge\">frida-il2cpp-bridge</a> </p>\n<h3 id=\"Supports\"><a href=\"#Supports\" class=\"headerlink\" title=\"Supports\"></a>Supports</h3><ul>\n<li><p>bilibili fate go v2.36.0</p>\n</li>\n<li><p>aniplex fate go v2.49.0</p>\n<p><em>fate go in other channels&#x2F;platforms&#x2F;versions may functional but it’s not tested</em></p>\n</li>\n</ul>\n<h3 id=\"Steps\"><a href=\"#Steps\" class=\"headerlink\" title=\"Steps\"></a>Steps</h3><h4 id=\"For-Android\"><a href=\"#For-Android\" class=\"headerlink\" title=\"For Android\"></a>For Android</h4><p>*<em>Android 10 or 11 is recommended, among testing in android 9 sometimes game may crash</em></p>\n<ul>\n<li><p>Install nodeJs for NPM</p>\n</li>\n<li><p>Install frida and frida-tools with <code> npm install frida &amp;&amp; npm install frida-tools</code></p>\n</li>\n<li><p>Download latest frida-server from <a href=\"https://github.com/frida/frida/releases\">https://github.com/frida/frida/releases</a></p>\n</li>\n<li><p>Start rooted device, rettach with <code> adb root</code></p>\n</li>\n<li><p>Install game apk</p>\n</li>\n<li><p>Copy <em><strong>frida-server</strong></em> file to device directory such as <em><strong>&#x2F;data&#x2F;local&#x2F;tmp</strong></em></p>\n</li>\n<li><p>Run <code>adb shell</code> to connect to device</p>\n</li>\n<li><p>Change <em><strong>frida-server</strong></em> file permission with <code>chmod 777 &#123;directory&#125;/frida-server</code></p>\n</li>\n<li><p>Navigate to directory and run server with <code>./frida-server</code></p>\n</li>\n</ul>\n<h4 id=\"For-IOS\"><a href=\"#For-IOS\" class=\"headerlink\" title=\"For IOS\"></a>For IOS</h4><ul>\n<li>TODO</li>\n</ul>\n<h4 id=\"Run-script\"><a href=\"#Run-script\" class=\"headerlink\" title=\"Run script\"></a>Run script</h4><ul>\n<li><p>See comments in <em><strong>fgo_hack_script.ts</strong></em>, and change codes according to the <em>fgo</em> version</p>\n<ul>\n<li>there is some tiny diffrences between <em>bili fatego</em> and <em>aniplex fatego</em></li>\n</ul>\n</li>\n<li><p>Build with <code>./build_aniplex.sh</code> or <code>./build_bili.sh</code></p>\n</li>\n<li><p>Run with <code>./run.sh com.bilibili.fgo</code> or <code>./run.sh com.aniplex.fategrandorder</code></p>\n<ul>\n<li>you could now see some logs (if codes like <code>console.log(...)</code> is uncommented) when starting battle</li>\n</ul>\n</li>\n<li><p>Have fun.</p>\n</li>\n</ul>\n<h3 id=\"Features\"><a href=\"#Features\" class=\"headerlink\" title=\"Features\"></a>Features</h3><p><img src=\"/images/0.jpg\" alt=\"in battle\"></p>\n<h4 id=\"active\"><a href=\"#active\" class=\"headerlink\" title=\"active\"></a>active</h4><ol>\n<li><p>Increase player’s servant hp (by 500,000)</p>\n</li>\n<li><p>Set all skills lv to 10 (both servant’s and master’s)</p>\n</li>\n<li><p>Change all skills charge turn down (to 1)</p>\n</li>\n<li><p>Try to disable codestage anti-cheat engine (notice that there is <strong>NO WAY</strong> to cheat safely cause anyway the battle data will be sent to game server)</p>\n</li>\n</ol>\n<h4 id=\"inactive\"><a href=\"#inactive\" class=\"headerlink\" title=\"inactive\"></a>inactive</h4><ol>\n<li><p>Never die (reset hp every time servant dies)</p>\n</li>\n<li><p>Increase attack &amp; defence np rate</p>\n</li>\n<li><p>Increase attack star rate</p>\n</li>\n</ol>\n<h3 id=\"Issues\"><a href=\"#Issues\" class=\"headerlink\" title=\"Issues\"></a>Issues</h3><ul>\n<li><p>Could not ran with X64-based simulator such as MuMu (tested) at this time (<a href=\"https://github.com/vfsfitvnm/frida-il2cpp-bridge\">frida-il2cpp-bridge</a> version 0.7.9)</p>\n</li>\n<li><p>Features in <a href=\"#inactive\">inactive</a> may invoked too frequently that may cause some leakage</p>\n</li>\n</ul>\n"},{"title":"Metaspace leakage caused by loading dynamic class","date":"2022-03-17T07:59:28.000Z","_content":"\n## cause\n\nDefine several classes with certain `name` by using `ClassLoader#defineClass` , no matter the `name` is specified or not, the HotSpot JVM always throws OOM in metaspace at last.\n\n## behavior of `ClassLoader#defineClass`\n\n![defineClass](jvm-metaspace-leakage-caused-by-loading-dynamic-class/0.png)\n\n`ClassLoader#defineClass` is JVM native method, the major steps are:\n\n1. parse class file and check if class file format is correct\n   \n   ![vm specification](jvm-metaspace-leakage-caused-by-loading-dynamic-class/1.png)\n\n2. check `systemDictionary` with parameter `name` to determine if Klass/KlassHandler is already loaded\n\n(pretend here are some source codes XD)\n\nBut if step-2 exists, why the metaspace memory exhausts at last?\n\n## what actually happens when VM parsing class file\n\nIn step-1 mentioned above, HotSpot VM not only parses the class file but save the class data structure (class code, vtable, itable, etc.) to metaspace. so even if the class name is totally the same, there is duplicated class data generated in metaspace, and which is the metaspace OOM cause.\n\n![native define class](jvm-metaspace-leakage-caused-by-loading-dynamic-class/2.png)\n\n![find klass in dict](jvm-metaspace-leakage-caused-by-loading-dynamic-class/3.png)\n\n![check if class already defined](jvm-metaspace-leakage-caused-by-loading-dynamic-class/4.png)\n\nWhy not just only parse the file without saving it to metaspace?\n\nIn my gusse:\n\n- In java code, most of class definition is done by `ClassLoader#loadClass()` which checks the class name before vm method invoked.\n  \n  ![loadClass in java](jvm-metaspace-leakage-caused-by-loading-dynamic-class/5.png)\n\n- There is not so many chances that class file format is bad (ClassFormatError), so it will be a large waste that parse class file and then dellocate the memory and then parse it again if system dictionary dosn't contain the same class handler.\n\n## Class data GC in metaspace\n\nActually there is no specific GC behavior in metaspace, in VM the GC always works in heap, but the pointer pointed to class data in metaspace is saved in class instance which lives in heap. So if the class instance is time to be collected, the class data in metaspace will be freed to.\n","source":"_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class.md","raw":"---\ntitle: Metaspace leakage caused by loading dynamic class\ndate: 2022-03-17 15:59:28\ncategories: \n\t- Java\ntags:\n  - JVM\n  - Java\n  - JVM Memory\n---\n\n## cause\n\nDefine several classes with certain `name` by using `ClassLoader#defineClass` , no matter the `name` is specified or not, the HotSpot JVM always throws OOM in metaspace at last.\n\n## behavior of `ClassLoader#defineClass`\n\n![defineClass](jvm-metaspace-leakage-caused-by-loading-dynamic-class/0.png)\n\n`ClassLoader#defineClass` is JVM native method, the major steps are:\n\n1. parse class file and check if class file format is correct\n   \n   ![vm specification](jvm-metaspace-leakage-caused-by-loading-dynamic-class/1.png)\n\n2. check `systemDictionary` with parameter `name` to determine if Klass/KlassHandler is already loaded\n\n(pretend here are some source codes XD)\n\nBut if step-2 exists, why the metaspace memory exhausts at last?\n\n## what actually happens when VM parsing class file\n\nIn step-1 mentioned above, HotSpot VM not only parses the class file but save the class data structure (class code, vtable, itable, etc.) to metaspace. so even if the class name is totally the same, there is duplicated class data generated in metaspace, and which is the metaspace OOM cause.\n\n![native define class](jvm-metaspace-leakage-caused-by-loading-dynamic-class/2.png)\n\n![find klass in dict](jvm-metaspace-leakage-caused-by-loading-dynamic-class/3.png)\n\n![check if class already defined](jvm-metaspace-leakage-caused-by-loading-dynamic-class/4.png)\n\nWhy not just only parse the file without saving it to metaspace?\n\nIn my gusse:\n\n- In java code, most of class definition is done by `ClassLoader#loadClass()` which checks the class name before vm method invoked.\n  \n  ![loadClass in java](jvm-metaspace-leakage-caused-by-loading-dynamic-class/5.png)\n\n- There is not so many chances that class file format is bad (ClassFormatError), so it will be a large waste that parse class file and then dellocate the memory and then parse it again if system dictionary dosn't contain the same class handler.\n\n## Class data GC in metaspace\n\nActually there is no specific GC behavior in metaspace, in VM the GC always works in heap, but the pointer pointed to class data in metaspace is saved in class instance which lives in heap. So if the class instance is time to be collected, the class data in metaspace will be freed to.\n","slug":"jvm-metaspace-leakage-caused-by-loading-dynamic-class","published":1,"updated":"2022-06-13T15:22:56.308Z","_id":"cl4cuks3w0004doou4upx5gu7","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"cause\"><a href=\"#cause\" class=\"headerlink\" title=\"cause\"></a>cause</h2><p>Define several classes with certain <code>name</code> by using <code>ClassLoader#defineClass</code> , no matter the <code>name</code> is specified or not, the HotSpot JVM always throws OOM in metaspace at last.</p>\n<h2 id=\"behavior-of-ClassLoader-defineClass\"><a href=\"#behavior-of-ClassLoader-defineClass\" class=\"headerlink\" title=\"behavior of ClassLoader#defineClass\"></a>behavior of <code>ClassLoader#defineClass</code></h2><p><img src=\"/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/0.png\" alt=\"defineClass\"></p>\n<p><code>ClassLoader#defineClass</code> is JVM native method, the major steps are:</p>\n<ol>\n<li><p>parse class file and check if class file format is correct</p>\n<p><img src=\"/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/1.png\" alt=\"vm specification\"></p>\n</li>\n<li><p>check <code>systemDictionary</code> with parameter <code>name</code> to determine if Klass&#x2F;KlassHandler is already loaded</p>\n</li>\n</ol>\n<p>(pretend here are some source codes XD)</p>\n<p>But if step-2 exists, why the metaspace memory exhausts at last?</p>\n<h2 id=\"what-actually-happens-when-VM-parsing-class-file\"><a href=\"#what-actually-happens-when-VM-parsing-class-file\" class=\"headerlink\" title=\"what actually happens when VM parsing class file\"></a>what actually happens when VM parsing class file</h2><p>In step-1 mentioned above, HotSpot VM not only parses the class file but save the class data structure (class code, vtable, itable, etc.) to metaspace. so even if the class name is totally the same, there is duplicated class data generated in metaspace, and which is the metaspace OOM cause.</p>\n<p><img src=\"/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/2.png\" alt=\"native define class\"></p>\n<p><img src=\"/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/3.png\" alt=\"find klass in dict\"></p>\n<p><img src=\"/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/4.png\" alt=\"check if class already defined\"></p>\n<p>Why not just only parse the file without saving it to metaspace?</p>\n<p>In my gusse:</p>\n<ul>\n<li><p>In java code, most of class definition is done by <code>ClassLoader#loadClass()</code> which checks the class name before vm method invoked.</p>\n<p><img src=\"/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/5.png\" alt=\"loadClass in java\"></p>\n</li>\n<li><p>There is not so many chances that class file format is bad (ClassFormatError), so it will be a large waste that parse class file and then dellocate the memory and then parse it again if system dictionary dosn’t contain the same class handler.</p>\n</li>\n</ul>\n<h2 id=\"Class-data-GC-in-metaspace\"><a href=\"#Class-data-GC-in-metaspace\" class=\"headerlink\" title=\"Class data GC in metaspace\"></a>Class data GC in metaspace</h2><p>Actually there is no specific GC behavior in metaspace, in VM the GC always works in heap, but the pointer pointed to class data in metaspace is saved in class instance which lives in heap. So if the class instance is time to be collected, the class data in metaspace will be freed to.</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"cause\"><a href=\"#cause\" class=\"headerlink\" title=\"cause\"></a>cause</h2><p>Define several classes with certain <code>name</code> by using <code>ClassLoader#defineClass</code> , no matter the <code>name</code> is specified or not, the HotSpot JVM always throws OOM in metaspace at last.</p>\n<h2 id=\"behavior-of-ClassLoader-defineClass\"><a href=\"#behavior-of-ClassLoader-defineClass\" class=\"headerlink\" title=\"behavior of ClassLoader#defineClass\"></a>behavior of <code>ClassLoader#defineClass</code></h2><p><img src=\"/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/0.png\" alt=\"defineClass\"></p>\n<p><code>ClassLoader#defineClass</code> is JVM native method, the major steps are:</p>\n<ol>\n<li><p>parse class file and check if class file format is correct</p>\n<p><img src=\"/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/1.png\" alt=\"vm specification\"></p>\n</li>\n<li><p>check <code>systemDictionary</code> with parameter <code>name</code> to determine if Klass&#x2F;KlassHandler is already loaded</p>\n</li>\n</ol>\n<p>(pretend here are some source codes XD)</p>\n<p>But if step-2 exists, why the metaspace memory exhausts at last?</p>\n<h2 id=\"what-actually-happens-when-VM-parsing-class-file\"><a href=\"#what-actually-happens-when-VM-parsing-class-file\" class=\"headerlink\" title=\"what actually happens when VM parsing class file\"></a>what actually happens when VM parsing class file</h2><p>In step-1 mentioned above, HotSpot VM not only parses the class file but save the class data structure (class code, vtable, itable, etc.) to metaspace. so even if the class name is totally the same, there is duplicated class data generated in metaspace, and which is the metaspace OOM cause.</p>\n<p><img src=\"/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/2.png\" alt=\"native define class\"></p>\n<p><img src=\"/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/3.png\" alt=\"find klass in dict\"></p>\n<p><img src=\"/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/4.png\" alt=\"check if class already defined\"></p>\n<p>Why not just only parse the file without saving it to metaspace?</p>\n<p>In my gusse:</p>\n<ul>\n<li><p>In java code, most of class definition is done by <code>ClassLoader#loadClass()</code> which checks the class name before vm method invoked.</p>\n<p><img src=\"/2022/03/17/jvm-metaspace-leakage-caused-by-loading-dynamic-class/5.png\" alt=\"loadClass in java\"></p>\n</li>\n<li><p>There is not so many chances that class file format is bad (ClassFormatError), so it will be a large waste that parse class file and then dellocate the memory and then parse it again if system dictionary dosn’t contain the same class handler.</p>\n</li>\n</ul>\n<h2 id=\"Class-data-GC-in-metaspace\"><a href=\"#Class-data-GC-in-metaspace\" class=\"headerlink\" title=\"Class data GC in metaspace\"></a>Class data GC in metaspace</h2><p>Actually there is no specific GC behavior in metaspace, in VM the GC always works in heap, but the pointer pointed to class data in metaspace is saved in class instance which lives in heap. So if the class instance is time to be collected, the class data in metaspace will be freed to.</p>\n"},{"title":"2022 06 13","date":"2022-06-13T07:09:40.000Z","_content":"\n## Spring RabbitMQ bindings\n\n>> exchange的`auto-declare`配置同时作用于binding，如果声明新的queue，但是绑定的exchange的auto-declare为false，则不会在既有的exchange上进行绑定\n\n```xml\n  <rabbit:queue id=\"queue0.id\" name=\"queue.0.name\"/>\n  <rabbit:fanout-exchange name=\"exchange.0.name\">\n    <rabbit:bindings>\n      <rabbit:binding queue=\"queue0.id\"/>\n    </rabbit:bindings>\n  </rabbit:fanout-exchange>\n\n```\n\n解析binding的入口：\n```java\n    protected void doParseBindings(Element element, ParserContext parserContext,\n\t\t\tString exchangeName, Element bindings, AbstractExchangeParser parser) {\n\t\tif (bindings != null) {\n\t\t\tfor (Element binding : DomUtils.getChildElementsByTagName(bindings, BINDING_ELE)) {\n                // 解析rabbit:binding\n\t\t\t\tBeanDefinitionBuilder bindingBuilder = parser.parseBinding(exchangeName, binding,\n\t\t\t\t\t\tparserContext);\n                // 这里是重点，解析bindings的时候，传入的是element，也就是rabbit:fanout-exchange对应的元素\n\t\t\t\tNamespaceUtils.parseDeclarationControls(element, bindingBuilder);\n\t\t\t\tBeanDefinition beanDefinition = bindingBuilder.getBeanDefinition();\n\t\t\t\tregisterBeanDefinition(new BeanDefinitionHolder(beanDefinition, parserContext.getReaderContext()\n\t\t\t\t\t\t.generateBeanName(beanDefinition)), parserContext.getRegistry());\n\t\t\t}\n\t\t}\n\t}\n```\n\n每个binding的自动声明`shouldDeclare`属性的设置：\n```java\n\t/**\n\t * Parses 'auto-declare' and 'declared-by' attributes.\n\t *\n\t * @param element The element.\n\t * @param builder The builder.\n\t */\n\tpublic static void parseDeclarationControls(Element element, BeanDefinitionBuilder builder) {\n        // 这里用exchange的auto-declare属性为每个binding设置shouldDeclare值\n\t\tNamespaceUtils.setValueIfAttributeDefined(builder, element, \"auto-declare\", \"shouldDeclare\");\n\t\tString admins = element.getAttribute(\"declared-by\");\n\t\tif (StringUtils.hasText(admins)) {\n\t\t\tString[] adminBeanNames = admins.split(\",\");\n\t\t\tManagedList<BeanReference> adminBeanRefs = new ManagedList<BeanReference>();\n\t\t\tfor (String adminBeanName : adminBeanNames) {\n\t\t\t\tadminBeanRefs.add(new RuntimeBeanReference(adminBeanName.trim()));\n\t\t\t}\n\t\t\tbuilder.addPropertyValue(\"adminsThatShouldDeclare\", adminBeanRefs);\n\t\t}\n\t\tNamespaceUtils.setValueIfAttributeDefined(builder, element, \"ignore-declaration-exceptions\");\n\t}\n```\n\n`shouldDeclare`在声明中的作用:\n```java\n\n\t/**\n\t * Remove any instances that should not be declared by this admin.\n\t * @param declarables the collection of {@link Declarable}s.\n\t * @return a new collection containing {@link Declarable}s that should be declared by this\n\t * admin.\n\t */\n\tprivate <T extends Declarable> Collection<T> filterDeclarables(Collection<T> declarables) {\n\t\tCollection<T> filtered = new ArrayList<T>();\n\t\tfor (T declarable : declarables) {\n\t\t\tCollection<?> adminsWithWhichToDeclare = declarable.getDeclaringAdmins();\n            // 此处只保留shouldDeclare=true的bean\n\t\t\tif (declarable.shouldDeclare() &&\n\t\t\t\t\t(adminsWithWhichToDeclare.isEmpty() || adminsWithWhichToDeclare.contains(this))) {\n\t\t\t\tfiltered.add(declarable);\n\t\t\t}\n\t\t}\n\t\treturn filtered;\n\t}\n```\n\n初始化的部分：\n```java\n\n\t/**\n\t * Declares all the exchanges, queues and bindings in the enclosing application context, if any. It should be safe\n\t * (but unnecessary) to call this method more than once.\n\t */\n\tpublic void initialize() {\n\n\t\t...\n\n\t\tfinal Collection<Exchange> exchanges = filterDeclarables(contextExchanges);\n\t\tfinal Collection<Queue> queues = filterDeclarables(contextQueues);\n        // 这里过滤掉了shouldDeclare=false的binding\n\t\tfinal Collection<Binding> bindings = filterDeclarables(contextBindings);\n\n\t\t...\n\n\t\tthis.rabbitTemplate.execute(new ChannelCallback<Object>() {\n\n\t\t\t@Override\n\t\t\tpublic Object doInRabbit(Channel channel) throws Exception {\n\t\t\t\tdeclareExchanges(channel, exchanges.toArray(new Exchange[exchanges.size()]));\n\t\t\t\tdeclareQueues(channel, queues.toArray(new Queue[queues.size()]));\n                // 向rabbit声明binding的部分\n\t\t\t\tdeclareBindings(channel, bindings.toArray(new Binding[bindings.size()]));\n\t\t\t\treturn null;\n\t\t\t}\n\t\t});\n\t\tthis.logger.debug(\"Declarations finished\");\n\n\t}\n```\n\n## org.springframework.web.util.UriComponentsBuilder\n\n>> 用来解析uri，用起来还可以\n\n```java\n    String url = \"http://domain:port/path1/subpath1?param0=0&param1=1\";\n\n    UriComponentsBuilder.fromHttpUrl(url).build();\n    UriComponentsBuilder.fromUri(URI.create(uri)).build();\n    UriComponentsBuilder.fromUriString(uri).build();\n    ....\n\n    uriComponents.getHost(); // e.g. domain\n    uriComponents.getPath(); // e.g. /path1/subpath1\n    uriComponents.getPathSegments(); // e.g. [path1, subpath1]\n    uriComponents.getScheme(); // e.g. http\n    uriComponents.getQueryParams(); // [param0:0, param1:1]\n\n```","source":"_posts/memo-2022-06-13.md","raw":"---\ntitle: 2022 06 13\ndate: 2022-06-13 15:09:40\ncategories: \n\t- Spring\ntags:\n\t- memo\n\t- RabbitMQ\n\t- Spring config\n\t- RabbitMQ config\n\t- Spring source code\n\t- util\n---\n\n## Spring RabbitMQ bindings\n\n>> exchange的`auto-declare`配置同时作用于binding，如果声明新的queue，但是绑定的exchange的auto-declare为false，则不会在既有的exchange上进行绑定\n\n```xml\n  <rabbit:queue id=\"queue0.id\" name=\"queue.0.name\"/>\n  <rabbit:fanout-exchange name=\"exchange.0.name\">\n    <rabbit:bindings>\n      <rabbit:binding queue=\"queue0.id\"/>\n    </rabbit:bindings>\n  </rabbit:fanout-exchange>\n\n```\n\n解析binding的入口：\n```java\n    protected void doParseBindings(Element element, ParserContext parserContext,\n\t\t\tString exchangeName, Element bindings, AbstractExchangeParser parser) {\n\t\tif (bindings != null) {\n\t\t\tfor (Element binding : DomUtils.getChildElementsByTagName(bindings, BINDING_ELE)) {\n                // 解析rabbit:binding\n\t\t\t\tBeanDefinitionBuilder bindingBuilder = parser.parseBinding(exchangeName, binding,\n\t\t\t\t\t\tparserContext);\n                // 这里是重点，解析bindings的时候，传入的是element，也就是rabbit:fanout-exchange对应的元素\n\t\t\t\tNamespaceUtils.parseDeclarationControls(element, bindingBuilder);\n\t\t\t\tBeanDefinition beanDefinition = bindingBuilder.getBeanDefinition();\n\t\t\t\tregisterBeanDefinition(new BeanDefinitionHolder(beanDefinition, parserContext.getReaderContext()\n\t\t\t\t\t\t.generateBeanName(beanDefinition)), parserContext.getRegistry());\n\t\t\t}\n\t\t}\n\t}\n```\n\n每个binding的自动声明`shouldDeclare`属性的设置：\n```java\n\t/**\n\t * Parses 'auto-declare' and 'declared-by' attributes.\n\t *\n\t * @param element The element.\n\t * @param builder The builder.\n\t */\n\tpublic static void parseDeclarationControls(Element element, BeanDefinitionBuilder builder) {\n        // 这里用exchange的auto-declare属性为每个binding设置shouldDeclare值\n\t\tNamespaceUtils.setValueIfAttributeDefined(builder, element, \"auto-declare\", \"shouldDeclare\");\n\t\tString admins = element.getAttribute(\"declared-by\");\n\t\tif (StringUtils.hasText(admins)) {\n\t\t\tString[] adminBeanNames = admins.split(\",\");\n\t\t\tManagedList<BeanReference> adminBeanRefs = new ManagedList<BeanReference>();\n\t\t\tfor (String adminBeanName : adminBeanNames) {\n\t\t\t\tadminBeanRefs.add(new RuntimeBeanReference(adminBeanName.trim()));\n\t\t\t}\n\t\t\tbuilder.addPropertyValue(\"adminsThatShouldDeclare\", adminBeanRefs);\n\t\t}\n\t\tNamespaceUtils.setValueIfAttributeDefined(builder, element, \"ignore-declaration-exceptions\");\n\t}\n```\n\n`shouldDeclare`在声明中的作用:\n```java\n\n\t/**\n\t * Remove any instances that should not be declared by this admin.\n\t * @param declarables the collection of {@link Declarable}s.\n\t * @return a new collection containing {@link Declarable}s that should be declared by this\n\t * admin.\n\t */\n\tprivate <T extends Declarable> Collection<T> filterDeclarables(Collection<T> declarables) {\n\t\tCollection<T> filtered = new ArrayList<T>();\n\t\tfor (T declarable : declarables) {\n\t\t\tCollection<?> adminsWithWhichToDeclare = declarable.getDeclaringAdmins();\n            // 此处只保留shouldDeclare=true的bean\n\t\t\tif (declarable.shouldDeclare() &&\n\t\t\t\t\t(adminsWithWhichToDeclare.isEmpty() || adminsWithWhichToDeclare.contains(this))) {\n\t\t\t\tfiltered.add(declarable);\n\t\t\t}\n\t\t}\n\t\treturn filtered;\n\t}\n```\n\n初始化的部分：\n```java\n\n\t/**\n\t * Declares all the exchanges, queues and bindings in the enclosing application context, if any. It should be safe\n\t * (but unnecessary) to call this method more than once.\n\t */\n\tpublic void initialize() {\n\n\t\t...\n\n\t\tfinal Collection<Exchange> exchanges = filterDeclarables(contextExchanges);\n\t\tfinal Collection<Queue> queues = filterDeclarables(contextQueues);\n        // 这里过滤掉了shouldDeclare=false的binding\n\t\tfinal Collection<Binding> bindings = filterDeclarables(contextBindings);\n\n\t\t...\n\n\t\tthis.rabbitTemplate.execute(new ChannelCallback<Object>() {\n\n\t\t\t@Override\n\t\t\tpublic Object doInRabbit(Channel channel) throws Exception {\n\t\t\t\tdeclareExchanges(channel, exchanges.toArray(new Exchange[exchanges.size()]));\n\t\t\t\tdeclareQueues(channel, queues.toArray(new Queue[queues.size()]));\n                // 向rabbit声明binding的部分\n\t\t\t\tdeclareBindings(channel, bindings.toArray(new Binding[bindings.size()]));\n\t\t\t\treturn null;\n\t\t\t}\n\t\t});\n\t\tthis.logger.debug(\"Declarations finished\");\n\n\t}\n```\n\n## org.springframework.web.util.UriComponentsBuilder\n\n>> 用来解析uri，用起来还可以\n\n```java\n    String url = \"http://domain:port/path1/subpath1?param0=0&param1=1\";\n\n    UriComponentsBuilder.fromHttpUrl(url).build();\n    UriComponentsBuilder.fromUri(URI.create(uri)).build();\n    UriComponentsBuilder.fromUriString(uri).build();\n    ....\n\n    uriComponents.getHost(); // e.g. domain\n    uriComponents.getPath(); // e.g. /path1/subpath1\n    uriComponents.getPathSegments(); // e.g. [path1, subpath1]\n    uriComponents.getScheme(); // e.g. http\n    uriComponents.getQueryParams(); // [param0:0, param1:1]\n\n```","slug":"memo-2022-06-13","published":1,"updated":"2022-06-13T15:31:34.726Z","_id":"cl4cuks3z0005dooua4uobmbd","comments":1,"layout":"post","photos":[],"link":"","content":"<h2 id=\"Spring-RabbitMQ-bindings\"><a href=\"#Spring-RabbitMQ-bindings\" class=\"headerlink\" title=\"Spring RabbitMQ bindings\"></a>Spring RabbitMQ bindings</h2><blockquote>\n<blockquote>\n<p>exchange的<code>auto-declare</code>配置同时作用于binding，如果声明新的queue，但是绑定的exchange的auto-declare为false，则不会在既有的exchange上进行绑定</p>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">rabbit:</span>queue</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>queue0.id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>queue.0.name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">rabbit:</span>fanout-exchange</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>exchange.0.name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">rabbit:</span>bindings</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">rabbit:</span>binding</span> <span class=\"token attr-name\">queue</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>queue0.id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">rabbit:</span>bindings</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">rabbit:</span>fanout-exchange</span><span class=\"token punctuation\">></span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>解析binding的入口：</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">   <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doParseBindings</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Element</span> element<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ParserContext</span> parserContext<span class=\"token punctuation\">,</span>\n\t\t<span class=\"token class-name\">String</span> exchangeName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Element</span> bindings<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AbstractExchangeParser</span> parser<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Element</span> binding <span class=\"token operator\">:</span> <span class=\"token class-name\">DomUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getChildElementsByTagName</span><span class=\"token punctuation\">(</span>bindings<span class=\"token punctuation\">,</span> BINDING_ELE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n               <span class=\"token comment\">// 解析rabbit:binding</span>\n\t\t\t<span class=\"token class-name\">BeanDefinitionBuilder</span> bindingBuilder <span class=\"token operator\">=</span> parser<span class=\"token punctuation\">.</span><span class=\"token function\">parseBinding</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> binding<span class=\"token punctuation\">,</span>\n\t\t\t\t\tparserContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n               <span class=\"token comment\">// 这里是重点，解析bindings的时候，传入的是element，也就是rabbit:fanout-exchange对应的元素</span>\n\t\t\t<span class=\"token class-name\">NamespaceUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseDeclarationControls</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">,</span> bindingBuilder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token class-name\">BeanDefinition</span> beanDefinition <span class=\"token operator\">=</span> bindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanDefinition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">registerBeanDefinition</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanDefinitionHolder</span><span class=\"token punctuation\">(</span>beanDefinition<span class=\"token punctuation\">,</span> parserContext<span class=\"token punctuation\">.</span><span class=\"token function\">getReaderContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">generateBeanName</span><span class=\"token punctuation\">(</span>beanDefinition<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> parserContext<span class=\"token punctuation\">.</span><span class=\"token function\">getRegistry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>每个binding的自动声明<code>shouldDeclare</code>属性的设置：</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token comment\">/**\n * Parses 'auto-declare' and 'declared-by' attributes.\n *\n * @param element The element.\n * @param builder The builder.\n */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">parseDeclarationControls</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Element</span> element<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanDefinitionBuilder</span> builder<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n       <span class=\"token comment\">// 这里用exchange的auto-declare属性为每个binding设置shouldDeclare值</span>\n\t<span class=\"token class-name\">NamespaceUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">setValueIfAttributeDefined</span><span class=\"token punctuation\">(</span>builder<span class=\"token punctuation\">,</span> element<span class=\"token punctuation\">,</span> <span class=\"token string\">\"auto-declare\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"shouldDeclare\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">String</span> admins <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"declared-by\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>admins<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> adminBeanNames <span class=\"token operator\">=</span> admins<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">ManagedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanReference</span><span class=\"token punctuation\">></span></span> adminBeanRefs <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ManagedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanReference</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> adminBeanName <span class=\"token operator\">:</span> adminBeanNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t\tadminBeanRefs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeBeanReference</span><span class=\"token punctuation\">(</span>adminBeanName<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">&#125;</span>\n\t\tbuilder<span class=\"token punctuation\">.</span><span class=\"token function\">addPropertyValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"adminsThatShouldDeclare\"</span><span class=\"token punctuation\">,</span> adminBeanRefs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token class-name\">NamespaceUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">setValueIfAttributeDefined</span><span class=\"token punctuation\">(</span>builder<span class=\"token punctuation\">,</span> element<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ignore-declaration-exceptions\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>shouldDeclare</code>在声明中的作用:</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">\n<span class=\"token comment\">/**\n * Remove any instances that should not be declared by this admin.\n * @param declarables the collection of &#123;@link Declarable&#125;s.\n * @return a new collection containing &#123;@link Declarable&#125;s that should be declared by this\n * admin.\n */</span>\n<span class=\"token keyword\">private</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Declarable</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">filterDeclarables</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> declarables<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> filtered <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> declarable <span class=\"token operator\">:</span> declarables<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> adminsWithWhichToDeclare <span class=\"token operator\">=</span> declarable<span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaringAdmins</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n           <span class=\"token comment\">// 此处只保留shouldDeclare=true的bean</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>declarable<span class=\"token punctuation\">.</span><span class=\"token function\">shouldDeclare</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n\t\t\t\t<span class=\"token punctuation\">(</span>adminsWithWhichToDeclare<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> adminsWithWhichToDeclare<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t\tfiltered<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>declarable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token keyword\">return</span> filtered<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>初始化的部分：</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">\n<span class=\"token comment\">/**\n * Declares all the exchanges, queues and bindings in the enclosing application context, if any. It should be safe\n * (but unnecessary) to call this method more than once.\n */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Exchange</span><span class=\"token punctuation\">></span></span> exchanges <span class=\"token operator\">=</span> <span class=\"token function\">filterDeclarables</span><span class=\"token punctuation\">(</span>contextExchanges<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Queue</span><span class=\"token punctuation\">></span></span> queues <span class=\"token operator\">=</span> <span class=\"token function\">filterDeclarables</span><span class=\"token punctuation\">(</span>contextQueues<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token comment\">// 这里过滤掉了shouldDeclare=false的binding</span>\n\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Binding</span><span class=\"token punctuation\">></span></span> bindings <span class=\"token operator\">=</span> <span class=\"token function\">filterDeclarables</span><span class=\"token punctuation\">(</span>contextBindings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelCallback</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n\t\t<span class=\"token annotation punctuation\">@Override</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">doInRabbit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Channel</span> channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span>\n\t\t\t<span class=\"token function\">declareExchanges</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">,</span> exchanges<span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Exchange</span><span class=\"token punctuation\">[</span>exchanges<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">declareQueues</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">,</span> queues<span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">[</span>queues<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n               <span class=\"token comment\">// 向rabbit声明binding的部分</span>\n\t\t\t<span class=\"token function\">declareBindings</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">,</span> bindings<span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Binding</span><span class=\"token punctuation\">[</span>bindings<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Declarations finished\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"org-springframework-web-util-UriComponentsBuilder\"><a href=\"#org-springframework-web-util-UriComponentsBuilder\" class=\"headerlink\" title=\"org.springframework.web.util.UriComponentsBuilder\"></a>org.springframework.web.util.UriComponentsBuilder</h2><blockquote>\n<blockquote>\n<p>用来解析uri，用起来还可以</p>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://domain:port/path1/subpath1?param0=0&amp;param1=1\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">UriComponentsBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromHttpUrl</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">UriComponentsBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromUri</span><span class=\"token punctuation\">(</span>URI<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>uri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">UriComponentsBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromUriString</span><span class=\"token punctuation\">(</span>uri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\nuriComponents<span class=\"token punctuation\">.</span><span class=\"token function\">getHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// e.g. domain</span>\nuriComponents<span class=\"token punctuation\">.</span><span class=\"token function\">getPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// e.g. /path1/subpath1</span>\nuriComponents<span class=\"token punctuation\">.</span><span class=\"token function\">getPathSegments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// e.g. [path1, subpath1]</span>\nuriComponents<span class=\"token punctuation\">.</span><span class=\"token function\">getScheme</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// e.g. http</span>\nuriComponents<span class=\"token punctuation\">.</span><span class=\"token function\">getQueryParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [param0:0, param1:1]</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"Spring-RabbitMQ-bindings\"><a href=\"#Spring-RabbitMQ-bindings\" class=\"headerlink\" title=\"Spring RabbitMQ bindings\"></a>Spring RabbitMQ bindings</h2><blockquote>\n<blockquote>\n<p>exchange的<code>auto-declare</code>配置同时作用于binding，如果声明新的queue，但是绑定的exchange的auto-declare为false，则不会在既有的exchange上进行绑定</p>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-xml\" data-language=\"xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">rabbit:</span>queue</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>queue0.id<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>queue.0.name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">rabbit:</span>fanout-exchange</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>exchange.0.name<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">rabbit:</span>bindings</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token namespace\">rabbit:</span>binding</span> <span class=\"token attr-name\">queue</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>queue0.id<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">/></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">rabbit:</span>bindings</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token namespace\">rabbit:</span>fanout-exchange</span><span class=\"token punctuation\">></span></span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>解析binding的入口：</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">   <span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">doParseBindings</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Element</span> element<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ParserContext</span> parserContext<span class=\"token punctuation\">,</span>\n\t\t<span class=\"token class-name\">String</span> exchangeName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Element</span> bindings<span class=\"token punctuation\">,</span> <span class=\"token class-name\">AbstractExchangeParser</span> parser<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bindings <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Element</span> binding <span class=\"token operator\">:</span> <span class=\"token class-name\">DomUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">getChildElementsByTagName</span><span class=\"token punctuation\">(</span>bindings<span class=\"token punctuation\">,</span> BINDING_ELE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n               <span class=\"token comment\">// 解析rabbit:binding</span>\n\t\t\t<span class=\"token class-name\">BeanDefinitionBuilder</span> bindingBuilder <span class=\"token operator\">=</span> parser<span class=\"token punctuation\">.</span><span class=\"token function\">parseBinding</span><span class=\"token punctuation\">(</span>exchangeName<span class=\"token punctuation\">,</span> binding<span class=\"token punctuation\">,</span>\n\t\t\t\t\tparserContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n               <span class=\"token comment\">// 这里是重点，解析bindings的时候，传入的是element，也就是rabbit:fanout-exchange对应的元素</span>\n\t\t\t<span class=\"token class-name\">NamespaceUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">parseDeclarationControls</span><span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">,</span> bindingBuilder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token class-name\">BeanDefinition</span> beanDefinition <span class=\"token operator\">=</span> bindingBuilder<span class=\"token punctuation\">.</span><span class=\"token function\">getBeanDefinition</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">registerBeanDefinition</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanDefinitionHolder</span><span class=\"token punctuation\">(</span>beanDefinition<span class=\"token punctuation\">,</span> parserContext<span class=\"token punctuation\">.</span><span class=\"token function\">getReaderContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t\t\t<span class=\"token punctuation\">.</span><span class=\"token function\">generateBeanName</span><span class=\"token punctuation\">(</span>beanDefinition<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> parserContext<span class=\"token punctuation\">.</span><span class=\"token function\">getRegistry</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>每个binding的自动声明<code>shouldDeclare</code>属性的设置：</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token comment\">/**\n * Parses 'auto-declare' and 'declared-by' attributes.\n *\n * @param element The element.\n * @param builder The builder.\n */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">parseDeclarationControls</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Element</span> element<span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanDefinitionBuilder</span> builder<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n       <span class=\"token comment\">// 这里用exchange的auto-declare属性为每个binding设置shouldDeclare值</span>\n\t<span class=\"token class-name\">NamespaceUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">setValueIfAttributeDefined</span><span class=\"token punctuation\">(</span>builder<span class=\"token punctuation\">,</span> element<span class=\"token punctuation\">,</span> <span class=\"token string\">\"auto-declare\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"shouldDeclare\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token class-name\">String</span> admins <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span><span class=\"token function\">getAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"declared-by\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">hasText</span><span class=\"token punctuation\">(</span>admins<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> adminBeanNames <span class=\"token operator\">=</span> admins<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">ManagedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanReference</span><span class=\"token punctuation\">></span></span> adminBeanRefs <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ManagedList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">BeanReference</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> adminBeanName <span class=\"token operator\">:</span> adminBeanNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t\tadminBeanRefs<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RuntimeBeanReference</span><span class=\"token punctuation\">(</span>adminBeanName<span class=\"token punctuation\">.</span><span class=\"token function\">trim</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">&#125;</span>\n\t\tbuilder<span class=\"token punctuation\">.</span><span class=\"token function\">addPropertyValue</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"adminsThatShouldDeclare\"</span><span class=\"token punctuation\">,</span> adminBeanRefs<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token class-name\">NamespaceUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">setValueIfAttributeDefined</span><span class=\"token punctuation\">(</span>builder<span class=\"token punctuation\">,</span> element<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ignore-declaration-exceptions\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p><code>shouldDeclare</code>在声明中的作用:</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">\n<span class=\"token comment\">/**\n * Remove any instances that should not be declared by this admin.\n * @param declarables the collection of &#123;@link Declarable&#125;s.\n * @return a new collection containing &#123;@link Declarable&#125;s that should be declared by this\n * admin.\n */</span>\n<span class=\"token keyword\">private</span> <span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Declarable</span><span class=\"token punctuation\">></span></span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">filterDeclarables</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> declarables<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t<span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> filtered <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">T</span> declarable <span class=\"token operator\">:</span> declarables<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t<span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> adminsWithWhichToDeclare <span class=\"token operator\">=</span> declarable<span class=\"token punctuation\">.</span><span class=\"token function\">getDeclaringAdmins</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n           <span class=\"token comment\">// 此处只保留shouldDeclare=true的bean</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>declarable<span class=\"token punctuation\">.</span><span class=\"token function\">shouldDeclare</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span>\n\t\t\t\t<span class=\"token punctuation\">(</span>adminsWithWhichToDeclare<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> adminsWithWhichToDeclare<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\t\t\tfiltered<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>declarable<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token keyword\">return</span> filtered<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>初始化的部分：</p>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\">\n<span class=\"token comment\">/**\n * Declares all the exchanges, queues and bindings in the enclosing application context, if any. It should be safe\n * (but unnecessary) to call this method more than once.\n */</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">initialize</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Exchange</span><span class=\"token punctuation\">></span></span> exchanges <span class=\"token operator\">=</span> <span class=\"token function\">filterDeclarables</span><span class=\"token punctuation\">(</span>contextExchanges<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Queue</span><span class=\"token punctuation\">></span></span> queues <span class=\"token operator\">=</span> <span class=\"token function\">filterDeclarables</span><span class=\"token punctuation\">(</span>contextQueues<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n       <span class=\"token comment\">// 这里过滤掉了shouldDeclare=false的binding</span>\n\t<span class=\"token keyword\">final</span> <span class=\"token class-name\">Collection</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Binding</span><span class=\"token punctuation\">></span></span> bindings <span class=\"token operator\">=</span> <span class=\"token function\">filterDeclarables</span><span class=\"token punctuation\">(</span>contextBindings<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>rabbitTemplate<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">ChannelCallback</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>\n\n\t\t<span class=\"token annotation punctuation\">@Override</span>\n\t\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">doInRabbit</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Channel</span> channel<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">&#123;</span>\n\t\t\t<span class=\"token function\">declareExchanges</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">,</span> exchanges<span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Exchange</span><span class=\"token punctuation\">[</span>exchanges<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token function\">declareQueues</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">,</span> queues<span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Queue</span><span class=\"token punctuation\">[</span>queues<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n               <span class=\"token comment\">// 向rabbit声明binding的部分</span>\n\t\t\t<span class=\"token function\">declareBindings</span><span class=\"token punctuation\">(</span>channel<span class=\"token punctuation\">,</span> bindings<span class=\"token punctuation\">.</span><span class=\"token function\">toArray</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">Binding</span><span class=\"token punctuation\">[</span>bindings<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">&#125;</span>\n\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">debug</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Declarations finished\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token punctuation\">&#125;</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h2 id=\"org-springframework-web-util-UriComponentsBuilder\"><a href=\"#org-springframework-web-util-UriComponentsBuilder\" class=\"headerlink\" title=\"org.springframework.web.util.UriComponentsBuilder\"></a>org.springframework.web.util.UriComponentsBuilder</h2><blockquote>\n<blockquote>\n<p>用来解析uri，用起来还可以</p>\n</blockquote>\n</blockquote>\n<pre class=\"line-numbers language-java\" data-language=\"java\"><code class=\"language-java\"><span class=\"token class-name\">String</span> url <span class=\"token operator\">=</span> <span class=\"token string\">\"http://domain:port/path1/subpath1?param0=0&amp;param1=1\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token class-name\">UriComponentsBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromHttpUrl</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">UriComponentsBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromUri</span><span class=\"token punctuation\">(</span>URI<span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>uri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token class-name\">UriComponentsBuilder</span><span class=\"token punctuation\">.</span><span class=\"token function\">fromUriString</span><span class=\"token punctuation\">(</span>uri<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\nuriComponents<span class=\"token punctuation\">.</span><span class=\"token function\">getHost</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// e.g. domain</span>\nuriComponents<span class=\"token punctuation\">.</span><span class=\"token function\">getPath</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// e.g. /path1/subpath1</span>\nuriComponents<span class=\"token punctuation\">.</span><span class=\"token function\">getPathSegments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// e.g. [path1, subpath1]</span>\nuriComponents<span class=\"token punctuation\">.</span><span class=\"token function\">getScheme</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// e.g. http</span>\nuriComponents<span class=\"token punctuation\">.</span><span class=\"token function\">getQueryParams</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// [param0:0, param1:1]</span>\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>"},{"title":"Some memos for shell script","date":"2022-03-19T15:27:41.000Z","_content":"\n- accept user input\n  \n  ```bash\n  read var\n  echo \"input value is $var\"\n  ```\n\n- do after pre-command succeed\n  \n  ```bash\n  rm somefile && echo \"removed\"\n  ```\n\n- do after pre-command failed\n  \n  ```bash\n  rm filenotexists || echo \"nothing removed\"\n  ```\n\n- redirect output\n  \n  - `1` means `stdout`, standard output\n  \n  - `2` means `stderr`, standard error output\n  \n  - `&` means \"as the same way\"\n  \n  - `dev/null` is a null file like a \"blak hole\", anything written to it is discard\n  \n  ```bash\n  echo \"blabla\" > dest.file\n  \n  # complete\n  echo \"blabla\" 1 > dest.file\n  \n  # error output to dest.file\n  rm filenotexists 2 > err.log\n  \n  # all output to dest.file\n  rm somefile 1 > dest.file 2>&1\n  \n  # only stdout\n  rm somefile 1 > dest.file 2 > dev/null\n  \n  # create 2 pipes, overwrites each other\n  rm somefile 1 > log 2 > log\n  \n  # 2 extends 1's pipe, works fine\n  rm somefile 1 > log 2>&1\n  ```\n\n- create blank file with certain size\n  \n  `dev/zero` as an input stream provides endless 0s (not ASCII '0')\n  \n  ```bash\n  # input file is /dev/zero\n  # output file is file\n  # write 10 times\n  # 1024 bytes every time\n  # so it creates a 10k blank file\n  dd if=/dev/zero of=file count=10 bs=1024\n  ```\n\n- if else\n  \n  ```bash\n  a=10\n  b=20\n  if [ $a == $b ]\n  then\n     echo \"a is equal to b\"\n  elif [ $a -gt $b ]\n  then\n     echo \"a greater than b\"\n  elif [ $a -lt $b ]\n  then\n     echo \"a less than b\"\n  else\n     echo \"\"\n  fi\n  ```\n\n- append to file\n  \n  ```bash\n  file1 >> file2\n  echo \"tails\" >> file\n  date >> file\n  ```\n","source":"_posts/shell-some-memos-for-shell-script.md","raw":"---\ntitle: Some memos for shell script\ndate: 2022-03-19 23:27:41\ncategories: \n\t- Linux\ntags:\n\t- memo\n\t- Linux\n\t- shell\n\t- shell script\n---\n\n- accept user input\n  \n  ```bash\n  read var\n  echo \"input value is $var\"\n  ```\n\n- do after pre-command succeed\n  \n  ```bash\n  rm somefile && echo \"removed\"\n  ```\n\n- do after pre-command failed\n  \n  ```bash\n  rm filenotexists || echo \"nothing removed\"\n  ```\n\n- redirect output\n  \n  - `1` means `stdout`, standard output\n  \n  - `2` means `stderr`, standard error output\n  \n  - `&` means \"as the same way\"\n  \n  - `dev/null` is a null file like a \"blak hole\", anything written to it is discard\n  \n  ```bash\n  echo \"blabla\" > dest.file\n  \n  # complete\n  echo \"blabla\" 1 > dest.file\n  \n  # error output to dest.file\n  rm filenotexists 2 > err.log\n  \n  # all output to dest.file\n  rm somefile 1 > dest.file 2>&1\n  \n  # only stdout\n  rm somefile 1 > dest.file 2 > dev/null\n  \n  # create 2 pipes, overwrites each other\n  rm somefile 1 > log 2 > log\n  \n  # 2 extends 1's pipe, works fine\n  rm somefile 1 > log 2>&1\n  ```\n\n- create blank file with certain size\n  \n  `dev/zero` as an input stream provides endless 0s (not ASCII '0')\n  \n  ```bash\n  # input file is /dev/zero\n  # output file is file\n  # write 10 times\n  # 1024 bytes every time\n  # so it creates a 10k blank file\n  dd if=/dev/zero of=file count=10 bs=1024\n  ```\n\n- if else\n  \n  ```bash\n  a=10\n  b=20\n  if [ $a == $b ]\n  then\n     echo \"a is equal to b\"\n  elif [ $a -gt $b ]\n  then\n     echo \"a greater than b\"\n  elif [ $a -lt $b ]\n  then\n     echo \"a less than b\"\n  else\n     echo \"\"\n  fi\n  ```\n\n- append to file\n  \n  ```bash\n  file1 >> file2\n  echo \"tails\" >> file\n  date >> file\n  ```\n","slug":"shell-some-memos-for-shell-script","published":1,"updated":"2022-06-13T15:23:18.306Z","_id":"cl4cuks410006doou2jnb1u2d","comments":1,"layout":"post","photos":[],"link":"","content":"<ul>\n<li><p>accept user input</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">read</span> var\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"input value is <span class=\"token variable\">$var</span>\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n</li>\n<li><p>do after pre-command succeed</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">rm</span> somefile <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"removed\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li><p>do after pre-command failed</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">rm</span> filenotexists <span class=\"token operator\">||</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"nothing removed\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li><p>redirect output</p>\n<ul>\n<li><p><code>1</code> means <code>stdout</code>, standard output</p>\n</li>\n<li><p><code>2</code> means <code>stderr</code>, standard error output</p>\n</li>\n<li><p><code>&amp;</code> means “as the same way”</p>\n</li>\n<li><p><code>dev/null</code> is a null file like a “blak hole”, anything written to it is discard</p>\n</li>\n</ul>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"blabla\"</span> <span class=\"token operator\">></span> dest.file\n\n<span class=\"token comment\"># complete</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"blabla\"</span> <span class=\"token number\">1</span> <span class=\"token operator\">></span> dest.file\n\n<span class=\"token comment\"># error output to dest.file</span>\n<span class=\"token function\">rm</span> filenotexists <span class=\"token number\">2</span> <span class=\"token operator\">></span> err.log\n\n<span class=\"token comment\"># all output to dest.file</span>\n<span class=\"token function\">rm</span> somefile <span class=\"token number\">1</span> <span class=\"token operator\">></span> dest.file <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span>\n\n<span class=\"token comment\"># only stdout</span>\n<span class=\"token function\">rm</span> somefile <span class=\"token number\">1</span> <span class=\"token operator\">></span> dest.file <span class=\"token number\">2</span> <span class=\"token operator\">></span> dev/null\n\n<span class=\"token comment\"># create 2 pipes, overwrites each other</span>\n<span class=\"token function\">rm</span> somefile <span class=\"token number\">1</span> <span class=\"token operator\">></span> log <span class=\"token number\">2</span> <span class=\"token operator\">></span> log\n\n<span class=\"token comment\"># 2 extends 1's pipe, works fine</span>\n<span class=\"token function\">rm</span> somefile <span class=\"token number\">1</span> <span class=\"token operator\">></span> log <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>create blank file with certain size</p>\n<p><code>dev/zero</code> as an input stream provides endless 0s (not ASCII ‘0’)</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># input file is /dev/zero</span>\n<span class=\"token comment\"># output file is file</span>\n<span class=\"token comment\"># write 10 times</span>\n<span class=\"token comment\"># 1024 bytes every time</span>\n<span class=\"token comment\"># so it creates a 10k blank file</span>\n<span class=\"token function\">dd</span> <span class=\"token assign-left variable\">if</span><span class=\"token operator\">=</span>/dev/zero <span class=\"token assign-left variable\">of</span><span class=\"token operator\">=</span>file <span class=\"token assign-left variable\">count</span><span class=\"token operator\">=</span><span class=\"token number\">10</span> <span class=\"token assign-left variable\">bs</span><span class=\"token operator\">=</span><span class=\"token number\">1024</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>if else</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">a</span><span class=\"token operator\">=</span><span class=\"token number\">10</span>\n<span class=\"token assign-left variable\">b</span><span class=\"token operator\">=</span><span class=\"token number\">20</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$a</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$b</span> <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n   <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"a is equal to b\"</span>\n<span class=\"token keyword\">elif</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$a</span> -gt <span class=\"token variable\">$b</span> <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n   <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"a greater than b\"</span>\n<span class=\"token keyword\">elif</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$a</span> -lt <span class=\"token variable\">$b</span> <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n   <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"a less than b\"</span>\n<span class=\"token keyword\">else</span>\n   <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"\"</span>\n<span class=\"token keyword\">fi</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>append to file</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">file1 <span class=\"token operator\">>></span> file2\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"tails\"</span> <span class=\"token operator\">>></span> <span class=\"token function\">file</span>\n<span class=\"token function\">date</span> <span class=\"token operator\">>></span> <span class=\"token function\">file</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<ul>\n<li><p>accept user input</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">read</span> var\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"input value is <span class=\"token variable\">$var</span>\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n</li>\n<li><p>do after pre-command succeed</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">rm</span> somefile <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"removed\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li><p>do after pre-command failed</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">rm</span> filenotexists <span class=\"token operator\">||</span> <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"nothing removed\"</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n</li>\n<li><p>redirect output</p>\n<ul>\n<li><p><code>1</code> means <code>stdout</code>, standard output</p>\n</li>\n<li><p><code>2</code> means <code>stderr</code>, standard error output</p>\n</li>\n<li><p><code>&amp;</code> means “as the same way”</p>\n</li>\n<li><p><code>dev/null</code> is a null file like a “blak hole”, anything written to it is discard</p>\n</li>\n</ul>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"blabla\"</span> <span class=\"token operator\">></span> dest.file\n\n<span class=\"token comment\"># complete</span>\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"blabla\"</span> <span class=\"token number\">1</span> <span class=\"token operator\">></span> dest.file\n\n<span class=\"token comment\"># error output to dest.file</span>\n<span class=\"token function\">rm</span> filenotexists <span class=\"token number\">2</span> <span class=\"token operator\">></span> err.log\n\n<span class=\"token comment\"># all output to dest.file</span>\n<span class=\"token function\">rm</span> somefile <span class=\"token number\">1</span> <span class=\"token operator\">></span> dest.file <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span>\n\n<span class=\"token comment\"># only stdout</span>\n<span class=\"token function\">rm</span> somefile <span class=\"token number\">1</span> <span class=\"token operator\">></span> dest.file <span class=\"token number\">2</span> <span class=\"token operator\">></span> dev/null\n\n<span class=\"token comment\"># create 2 pipes, overwrites each other</span>\n<span class=\"token function\">rm</span> somefile <span class=\"token number\">1</span> <span class=\"token operator\">></span> log <span class=\"token number\">2</span> <span class=\"token operator\">></span> log\n\n<span class=\"token comment\"># 2 extends 1's pipe, works fine</span>\n<span class=\"token function\">rm</span> somefile <span class=\"token number\">1</span> <span class=\"token operator\">></span> log <span class=\"token operator\"><span class=\"token file-descriptor important\">2</span>></span><span class=\"token file-descriptor important\">&amp;1</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>create blank file with certain size</p>\n<p><code>dev/zero</code> as an input stream provides endless 0s (not ASCII ‘0’)</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token comment\"># input file is /dev/zero</span>\n<span class=\"token comment\"># output file is file</span>\n<span class=\"token comment\"># write 10 times</span>\n<span class=\"token comment\"># 1024 bytes every time</span>\n<span class=\"token comment\"># so it creates a 10k blank file</span>\n<span class=\"token function\">dd</span> <span class=\"token assign-left variable\">if</span><span class=\"token operator\">=</span>/dev/zero <span class=\"token assign-left variable\">of</span><span class=\"token operator\">=</span>file <span class=\"token assign-left variable\">count</span><span class=\"token operator\">=</span><span class=\"token number\">10</span> <span class=\"token assign-left variable\">bs</span><span class=\"token operator\">=</span><span class=\"token number\">1024</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>if else</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token assign-left variable\">a</span><span class=\"token operator\">=</span><span class=\"token number\">10</span>\n<span class=\"token assign-left variable\">b</span><span class=\"token operator\">=</span><span class=\"token number\">20</span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$a</span> <span class=\"token operator\">==</span> <span class=\"token variable\">$b</span> <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n   <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"a is equal to b\"</span>\n<span class=\"token keyword\">elif</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$a</span> -gt <span class=\"token variable\">$b</span> <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n   <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"a greater than b\"</span>\n<span class=\"token keyword\">elif</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$a</span> -lt <span class=\"token variable\">$b</span> <span class=\"token punctuation\">]</span>\n<span class=\"token keyword\">then</span>\n   <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"a less than b\"</span>\n<span class=\"token keyword\">else</span>\n   <span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"\"</span>\n<span class=\"token keyword\">fi</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n</li>\n<li><p>append to file</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">file1 <span class=\"token operator\">>></span> file2\n<span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"tails\"</span> <span class=\"token operator\">>></span> <span class=\"token function\">file</span>\n<span class=\"token function\">date</span> <span class=\"token operator\">>></span> <span class=\"token function\">file</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre></li>\n</ul>\n"}],"PostAsset":[{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class/0.png","slug":"0.png","post":"cl4cuks3w0004doou4upx5gu7","modified":0,"renderable":0},{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class/1.png","slug":"1.png","post":"cl4cuks3w0004doou4upx5gu7","modified":0,"renderable":0},{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class/2.png","slug":"2.png","post":"cl4cuks3w0004doou4upx5gu7","modified":0,"renderable":0},{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class/3.png","slug":"3.png","post":"cl4cuks3w0004doou4upx5gu7","modified":0,"renderable":0},{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class/4.png","slug":"4.png","post":"cl4cuks3w0004doou4upx5gu7","modified":0,"renderable":0},{"_id":"source/_posts/jvm-metaspace-leakage-caused-by-loading-dynamic-class/5.png","slug":"5.png","post":"cl4cuks3w0004doou4upx5gu7","modified":0,"renderable":0}],"PostCategory":[{"post_id":"cl4cuks3z0005dooua4uobmbd","category_id":"cl4cuyblr00024coudxtqfdb4","_id":"cl4cuybls00034coue9oo7a9h"},{"post_id":"cl4cuks3p0001dooua78r5dx4","category_id":"cl4cvo9y7000hagoufsyweg58","_id":"cl4cvo9y8000kagou8dhyhrud"},{"post_id":"cl4cuks3w0004doou4upx5gu7","category_id":"cl4cvwzgy001xagou78ybcy1h","_id":"cl4cvwzgy001yagoufxajhk0b"},{"post_id":"cl4cuks410006doou2jnb1u2d","category_id":"cl4cvo9y7000hagoufsyweg58","_id":"cl4cvxgg6001zagou8drk5p1h"},{"post_id":"cl4cuks3u0003doou1szpazpk","category_id":"cl4cvy2k90020agou04xg4gui","_id":"cl4cvy2ka0021agoubuweelsx"}],"PostTag":[{"post_id":"cl4cuks3z0005dooua4uobmbd","tag_id":"cl4cvlknv0001agou2jv893st","_id":"cl4cvlkny0007agoue0yi01o0"},{"post_id":"cl4cuks3z0005dooua4uobmbd","tag_id":"cl4cvlknw0002agou0mesh818","_id":"cl4cvlkny0008agouaplj8vuq"},{"post_id":"cl4cuks3z0005dooua4uobmbd","tag_id":"cl4cvlknw0003agouddrb5fb2","_id":"cl4cvlkny0009agouanba2519"},{"post_id":"cl4cuks3z0005dooua4uobmbd","tag_id":"cl4cvlknx0004agoug0wb4bg3","_id":"cl4cvlkny000aagou5vc6el79"},{"post_id":"cl4cuks3z0005dooua4uobmbd","tag_id":"cl4cvlknx0005agoudl3b0j0l","_id":"cl4cvlkny000bagou7znabn6g"},{"post_id":"cl4cuks3z0005dooua4uobmbd","tag_id":"cl4cvloxj000fagou1uh80ve1","_id":"cl4cvloxj000gagoucyhf4xl6"},{"post_id":"cl4cuks3p0001dooua78r5dx4","tag_id":"cl4cvo9y7000iagou2gmh6ylc","_id":"cl4cvo9y9000magoubrqfau4n"},{"post_id":"cl4cuks3p0001dooua78r5dx4","tag_id":"cl4cvo9y8000jagou8rylerdl","_id":"cl4cvo9y9000nagouaqjp84vy"},{"post_id":"cl4cuks3p0001dooua78r5dx4","tag_id":"cl4cvo9y8000lagou7swh9hzn","_id":"cl4cvo9y9000oagoua3csd24c"},{"post_id":"cl4cuks3u0003doou1szpazpk","tag_id":"cl4cvoqca000pagou6xc2h9q2","_id":"cl4cvoqca000qagou3skuens4"},{"post_id":"cl4cuks3u0003doou1szpazpk","tag_id":"cl4cvqp2h000zagou9ea3d2py","_id":"cl4cvqp2i0010agou2z8pam9z"},{"post_id":"cl4cuks3w0004doou4upx5gu7","tag_id":"cl4cvta7w0014agou0yg3cjjx","_id":"cl4cvta7x0019agou4r0ahmzn"},{"post_id":"cl4cuks3w0004doou4upx5gu7","tag_id":"cl4cvta7w0015agouhobm75md","_id":"cl4cvta7x001bagou31py3j4z"},{"post_id":"cl4cuks3w0004doou4upx5gu7","tag_id":"cl4cvta7w0017agoudgazbjgf","_id":"cl4cvta7x001cagouapz8dc8o"},{"post_id":"cl4cuks410006doou2jnb1u2d","tag_id":"cl4cvlknv0001agou2jv893st","_id":"cl4cvuxe9001hagoudcic4qsv"},{"post_id":"cl4cuks410006doou2jnb1u2d","tag_id":"cl4cvo9y8000lagou7swh9hzn","_id":"cl4cvuxe9001iagou3i7m85h4"},{"post_id":"cl4cuks410006doou2jnb1u2d","tag_id":"cl4cvuxe9001eagoudd2a04f4","_id":"cl4cvuxe9001jagoueg125jbf"},{"post_id":"cl4cuks410006doou2jnb1u2d","tag_id":"cl4cvv1ga001nagou2qbh52f8","_id":"cl4cvv1gb001oagou2ea6el46"},{"post_id":"cl4cuks3u0003doou1szpazpk","tag_id":"cl4cvwq8y001sagou1r7zbnym","_id":"cl4cvwq8z001vagoucjl068s3"},{"post_id":"cl4cuks3u0003doou1szpazpk","tag_id":"cl4cvwq8y001tagou9rtg2awo","_id":"cl4cvwq8z001wagou315wf5qf"}],"Tag":[{"name":"spring","_id":"cl4cuks440008dooud181e4qy"},{"name":"memo","_id":"cl4cvlknv0001agou2jv893st"},{"name":"RabbitMQ","_id":"cl4cvlknw0002agou0mesh818"},{"name":"Spring config","_id":"cl4cvlknw0003agouddrb5fb2"},{"name":"RabbitMQ config","_id":"cl4cvlknx0004agoug0wb4bg3"},{"name":"Spring source code","_id":"cl4cvlknx0005agoudl3b0j0l"},{"name":"Utils","_id":"cl4cvlknx0006agouac6n6syr"},{"name":"Util","_id":"cl4cvlmji000dagou5o6f98hk"},{"name":"util","_id":"cl4cvloxj000fagou1uh80ve1"},{"name":"setup","_id":"cl4cvo9y7000iagou2gmh6ylc"},{"name":"Arch Linux","_id":"cl4cvo9y8000jagou8rylerdl"},{"name":"Linux","_id":"cl4cvo9y8000lagou7swh9hzn"},{"name":"wallhack","_id":"cl4cvoqca000pagou6xc2h9q2"},{"name":"game injection","_id":"cl4cvq6ml000vagou6ofm9ce9"},{"name":"Fgo","_id":"cl4cvqdpg000xagou3jxx4er9"},{"name":"fgo","_id":"cl4cvqp2h000zagou9ea3d2py"},{"name":"JVM","_id":"cl4cvta7w0014agou0yg3cjjx"},{"name":"Java","_id":"cl4cvta7w0015agouhobm75md"},{"name":"JVM Memory","_id":"cl4cvta7w0017agoudgazbjgf"},{"name":"shell","_id":"cl4cvuxe9001eagoudd2a04f4"},{"name":"script","_id":"cl4cvuxe9001fagou0edm4pur"},{"name":"shell script","_id":"cl4cvv1ga001nagou2qbh52f8"},{"name":"injection","_id":"cl4cvwq8y001sagou1r7zbnym"},{"name":"reverse engineering","_id":"cl4cvwq8y001tagou9rtg2awo"}]}}